/*
 * @license easeljs
 * Visit http://createjs.com for documentation, updates and examples.
 *
 * Copyright (c) 2017 gskinner.com, inc.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 */
!function(t){"use strict";var e=(function(){function t(t){this.value=t}function e(e){function i(t,e){return new Promise(function(i,n){var a={key:t,arg:e,resolve:i,reject:n,next:null};o?o=o.next=a:(s=o=a,r(t,e))})}function r(i,s){try{var o=e[i](s),a=o.value;a instanceof t?Promise.resolve(a.value).then(function(t){r("next",t)},function(t){r("throw",t)}):n(o.done?"return":"normal",o.value)}catch(t){n("throw",t)}}function n(t,e){switch(t){case"return":s.resolve({value:e,done:!0});break;case"throw":s.reject(e);break;default:s.resolve({value:e,done:!1})}s=s.next,s?r(s.key,s.arg):o=null}var s,o;this._invoke=i,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),n=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},o=function(){function t(i){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e(this,t),this.type=i,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=r,this.cancelable=n,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}return t.prototype.preventDefault=function(){this.defaultPrevented=this.cancelable},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t.prototype.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},t.prototype.remove=function(){this.removed=!0},t.prototype.clone=function(){var e=new t(this.type,this.bubbles,this.cancelable);for(var i in this)this.hasOwnProperty(i)&&(e[i]=this[i]);return e},t.prototype.set=function(t){for(var e in t)this[e]=t[e];return this},t.prototype.toString=function(){return"["+this.constructor.name+" (type="+this.type+")]"},t}(),a=function(){function t(){e(this,t),this._listeners=null,this._captureListeners=null}return t.initialize=function(e){var i=t.prototype;e.addEventListener=i.addEventListener,e.on=i.on,e.removeEventListener=e.off=i.removeEventListener,e.removeAllEventListeners=i.removeAllEventListeners,e.hasEventListener=i.hasEventListener,e.dispatchEvent=i.dispatchEvent,e._dispatchEvent=i._dispatchEvent,e.willTrigger=i.willTrigger},t.prototype.addEventListener=function(t,e,i){var r=void 0;r=i?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var n=r[t];return n&&this.removeEventListener(t,e,i),n=r[t],n?n.push(e):r[t]=[e],e},t.prototype.on=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return e.handleEvent&&(i=i||e,e=e.handleEvent),i=i||this,this.addEventListener(t,function(t){e.call(i,t,n),r&&t.remove()},s)},t.prototype.removeEventListener=function(t,e,i){var r=i?this._captureListeners:this._listeners;if(r){var n=r[t];if(n)for(var s=n.length,o=0;o<s;o++)if(n[o]==e){1==s?delete r[t]:n.splice(o,1);break}}},t.prototype.off=function(t,e,i){this.removeEventListener(t,e,i)},t.prototype.removeAllEventListeners=function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},t.prototype.dispatchEvent=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"==typeof t){var r=this._listeners;if(!(e||r&&r[t]))return!0;t=new o(t,e,i)}else t.target&&t.clone&&(t=t.clone());try{t.target=this}catch(t){}if(t.bubbles&&this.parent){for(var n=this,s=void 0,a=[n];n.parent;)a.push(n=n.parent);var h=a.length;for(s=h-1;s>=0&&!t.propagationStopped;s--)a[s]._dispatchEvent(t,1+(0==s));for(s=1;s<h&&!t.propagationStopped;s++)a[s]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return!t.defaultPrevented},t.prototype.hasEventListener=function(t){var e=this._listeners,i=this._captureListeners;return!!(e&&e[t]||i&&i[t])},t.prototype.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.parent}return!1},t.prototype.toString=function(){return"[EventDispatcher]"},t.prototype._dispatchEvent=function(t,e){var i=1==e?this._captureListeners:this._listeners,r=void 0;if(t&&i){var n=i[t.type];if(!n||!(r=n.length))return;try{t.currentTarget=this}catch(t){}try{t.eventPhase=e}catch(t){}t.removed=!1,n=n.slice();for(var s=0;s<r&&!t.immediatePropagationStopped;s++){var o=n[s];o.handleEvent?o.handleEvent(t):o(t),t.removed&&(this.off(t.type,o,1==e),t.removed=!1)}}},t}(),h=function(t){function i(r){e(this,i);var n=s(this,t.call(this));return n.name=r,n.timingMode=i.TIMEOUT,n.maxDelta=0,n.paused=!1,n._inited=!1,n._startTime=0,n._pausedTime=0,n._ticks=0,n._pausedTicks=0,n._interval=50,n._lastTime=0,n._times=null,n._tickTimes=null,n._timerId=null,n._raf=!0,n}return n(i,t),i.prototype.create=function(t){return new i(t)},i.prototype.init=function(){this._inited||(this._inited=!0,this._times=[],this._tickTimes=[],this._startTime=this._getTime(),this._times.push(this._lastTime=0),this._setupTick())},i.prototype.reset=function(){if(this._raf){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;t&&t(this._timerId)}else clearTimeout(this._timerId);this.removeAllEventListeners("tick"),this._timerId=this._times=this._tickTimes=null,this._startTime=this._lastTime=this._ticks=0,this._inited=!1},i.prototype.addEventListener=function(e,i,r){return!this._inited&&this.init(),t.prototype.addEventListener.call(this,e,i,r)},i.prototype.getMeasuredTickTime=function(t){var e=this._tickTimes;if(!e||e.length<1)return-1;t=Math.min(e.length,t||0|this.framerate);var i=e.reduce(function(t,e){return t+e},0);return i/t},i.prototype.getMeasuredFPS=function(t){var e=this._times;return!e||e.length<2?-1:(t=Math.min(e.length-1,t||0|this.framerate),1e3/((e[0]-e[t])/t))},i.prototype.getTime=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._startTime?this._getTime()-(t?this._pausedTime:0):-1},i.prototype.getEventTime=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._startTime?(this._lastTime||this._startTime)-(t?this._pausedTime:0):-1},i.prototype.getTicks=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._ticks-(t?this._pausedTicks:0)},i.prototype._handleSynch=function(){this._timerId=null,this._setupTick(),this._getTime()-this._lastTime>=.97*(this._interval-1)&&this._tick()},i.prototype._handleRAF=function(){this._timerId=null,this._setupTick(),this._tick()},i.prototype._handleTimeout=function(){this._timerId=null,this._setupTick(),this._tick()},i.prototype._setupTick=function(){if(null==this._timerId){var t=this.timingMode||this._raf&&i.RAF;if(t==i.RAF_SYNCHED||t==i.RAF){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(e)return this._timerId=e(t==i.RAF?this._handleRAF.bind(this):this._handleSynch.bind(this)),void(this._raf=!0)}this._raf=!1,this._timerId=setTimeout(this._handleTimeout.bind(this),this._interval)}},i.prototype._tick=function(){var t=this.paused,e=this._getTime(),i=e-this._lastTime;if(this._lastTime=e,this._ticks++,t&&(this._pausedTicks++,this._pausedTime+=i),this.hasEventListener("tick")){var r=new o("tick"),n=this.maxDelta;r.delta=n&&i>n?n:i,r.paused=t,r.time=e,r.runTime=e-this._pausedTime,this.dispatchEvent(r)}for(this._tickTimes.unshift(this._getTime()-e);this._tickTimes.length>100;)this._tickTimes.pop();for(this._times.unshift(e);this._times.length>100;)this._times.pop()},i.prototype._getTime=function(){var t=window.performance.now;return(t&&t.call(performance)||(new Date).getTime())-this._startTime},r(i,[{key:"interval",get:function(){return this._interval},set:function(t){this._interval=t,this._inited&&this._setupTick()}},{key:"framerate",get:function(){return 1e3/this._interval},set:function(t){this.interval=1e3/t}}]),i}(a);h.RAF_SYNCHED="synched",h.RAF="raf",h.TIMEOUT="timeout";var u=new h("createjs.global"),l=0,c=function(){function t(){throw e(this,t),"UID cannot be instantiated"}return t.get=function(){return t._nextID++},r(t,null,[{key:"_nextID",get:function(){return l},set:function(t){l=t}}]),t}(),p=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.setValues(i,r)}return t.prototype.setValues=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t,this.y=e,this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"["+this.constructor.name+" (x="+this.x+" y="+this.y+")]"},t}(),d=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;e(this,t),this.setValues(i,r,n,s,o,a)}return t.prototype.setValues=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=s,this},t.prototype.append=function(t,e,i,r,n,s){var o=this.a,a=this.b,h=this.c,u=this.d;return 1==t&&0==e&&0==i&&1==r||(this.a=o*t+h*e,this.b=a*t+u*e,this.c=o*i+h*r,this.d=a*i+u*r),this.tx=o*n+h*s+this.tx,this.ty=a*n+u*s+this.ty,this},t.prototype.prepend=function(t,e,i,r,n,s){var o=this.a,a=this.c,h=this.tx;return this.a=t*o+i*this.b,this.b=e*o+r*this.b,this.c=t*a+i*this.d,this.d=e*a+r*this.d,this.tx=t*h+i*this.ty+n,this.ty=e*h+r*this.ty+s,this},t.prototype.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.appendTransform=function(e,i,r,n,s,o,a,h,u){var l=void 0,c=void 0,p=void 0;return s%360?(l=s*t.DEG_TO_RAD,c=Math.cos(l),p=Math.sin(l)):(c=1,p=0),o||a?(o*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.append(Math.cos(a),Math.sin(a),-Math.sin(o),Math.cos(o),e,i),this.append(c*r,p*r,-p*n,c*n,0,0)):this.append(c*r,p*r,-p*n,c*n,e,i),(h||u)&&(this.tx-=h*this.a+u*this.c,this.ty-=h*this.b+u*this.d),this},t.prototype.prependTransform=function(e,i,r,n,s,o,a,h,u){var l=void 0,c=void 0,p=void 0;return s%360?(l=s*t.DEG_TO_RAD,c=Math.cos(l),p=Math.sin(l)):(c=1,p=0),(h||u)&&(this.tx-=h,this.ty-=u),o||a?(o*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.prepend(c*r,p*r,-p*n,c*n,0,0),this.prepend(Math.cos(a),Math.sin(a),-Math.sin(o),Math.cos(o),e,i)):this.prepend(c*r,p*r,-p*n,c*n,e,i),this},t.prototype.rotate=function(e){e*=t.DEG_TO_RAD;var i=Math.cos(e),r=Math.sin(e),n=this.a,s=this.b;return this.a=n*i+this.c*r,this.b=s*i+this.d*r,this.c=-n*r+this.c*i,this.d=-s*r+this.d*i,this},t.prototype.skew=function(e,i){return e*=t.DEG_TO_RAD,i*=t.DEG_TO_RAD,this.append(Math.cos(i),Math.sin(i),-Math.sin(e),Math.cos(e),0,0),this},t.prototype.scale=function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this},t.prototype.translate=function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,s=t*r-e*i;return this.a=r/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-r*n)/s,this.ty=-(t*this.ty-e*n)/s,this},t.prototype.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},t.prototype.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d},t.prototype.transformPoint=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p;return i.x=t*this.a+e*this.c+this.tx,i.y=t*this.b+e*this.d+this.ty,i},t.prototype.decompose=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var i=Math.atan2(-this.c,this.d),r=Math.atan2(this.b,this.a),n=Math.abs(1-i/r);return n<1e-5?(e.rotation=r/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=i/t.DEG_TO_RAD,e.skewY=r/t.DEG_TO_RAD),e},t.prototype.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)},t.prototype.toString=function(){return"["+this.constructor.name+" (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t}();d.DEG_TO_RAD=Math.PI/180,d.identity=new d;var _=function(){function t(){var i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments[2],s=arguments[3],o=arguments[4];e(this,t),this.setValues(i,r,n,s,o)}return t.prototype.setValues=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments[2],r=arguments[3],n=arguments[4];return this.visible=t,this.alpha=e,this.shadow=i,this.compositeOperation=r,this.matrix=n||this.matrix&&this.matrix.identity()||new d,this},t.prototype.append=function(t,e,i,r,n){return this.alpha*=e,this.shadow=i||this.shadow,this.compositeOperation=r||this.compositeOperation,this.visible=this.visible&&t,n&&this.matrix.appendMatrix(n),this},t.prototype.prepend=function(t,e,i,r,n){return this.alpha*=e,this.shadow=this.shadow||i,this.compositeOperation=this.compositeOperation||r,this.visible=this.visible&&t,n&&this.matrix.prependMatrix(n),this},t.prototype.identity=function(){return this.visible=!0,this.alpha=1,this.shadow=this.compositeOperation=null,this.matrix.identity(),this},t.prototype.clone=function(){return new t(this.alpha,this.shadow,this.compositeOperation,this.visible,this.matrix.clone())},t}(),f=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.setValues(i,r,n,s)}return t.prototype.setValues=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.x=t,this.y=e,this.width=i,this.height=r,this},t.prototype.extend=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t+i>this.x+this.width&&(this.width=t+i-this.x),e+r>this.y+this.height&&(this.height=e+r-this.y),t<this.x&&(this.width+=this.x-t,this.x=t),e<this.y&&(this.height+=this.y-e,this.y=e),this},t.prototype.pad=function(t,e,i,r){return this.x-=e,this.y-=t,this.width+=e+r,this.height+=t+i,this},t.prototype.copy=function(t){return this.setValues(t.x,t.y,t.width,t.height)},t.prototype.contains=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t>=this.x&&t+i<=this.x+this.width&&e>=this.y&&e+r<=this.y+this.height},t.prototype.union=function(t){return this.clone().extend(t.x,t.y,t.width,t.height)},t.prototype.intersection=function(e){var i=e.x,r=e.y,n=i+e.width,s=r+e.height;return this.x>i&&(i=this.x),this.y>r&&(r=this.y),this.x+this.width<n&&(n=this.x+this.width),this.y+this.height<s&&(s=this.y+this.height),n<=i||s<=r?null:new t(i,r,n-i,s-r)},t.prototype.intersects=function(t){return t.x<=this.x+this.width&&this.x<=t.x+t.width&&t.y<=this.y+this.height&&this.y<=t.y+t.height},t.prototype.isEmpty=function(){return this.width<=0||this.height<=0},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.toString=function(){return"["+this.constructor.name+" (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},t}(),v=function(){function t(){e(this,t),this.VTX_SHADER_BODY=null,this.FRAG_SHADER_BODY=null}return t.prototype.getBounds=function(t){return t},t.prototype.shaderParamSetup=function(t,e,i){},t.prototype.applyFilter=function(t,e,i,r,n,s,o,a){s=s||t,null==o&&(o=e),null==a&&(a=i);try{var h=t.getImageData(e,i,r,n);if(this._applyFilter(h))return s.putImageData(h,o,a),!0}catch(t){}return!1},t.prototype.toString=function(){return"["+this.constructor.name+"]"},t.prototype.clone=function(){return new t},t.prototype._applyFilter=function(t){return!0},t}(),g=function(t){function i(){e(this,i);var r=s(this,t.call(this));return r.width=void 0,r.height=void 0,r.x=void 0,r.y=void 0,r.scale=1,r.offX=0,r.offY=0,r.cacheID=0,r._filterOffX=0,r._filterOffY=0,r._cacheDataURLID=0,r._cacheDataURL=null,r._drawWidth=0,r._drawHeight=0,r}return n(i,t),i.getFilterBounds=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f,i=t.filters,r=i&&i.length;if(r>0)return e;for(var n=0;n<r;n++){var s=i[n];if(s&&s.getBounds){var o=s.getBounds();o&&(0==n?e.setValues(o.x,o.y,o.width,o.height):e.extend(o.x,o.y,o.width,o.height))}}return e},i.prototype.define=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments[6];if(!t)throw"No symbol to cache";this._options=o,this._useWebGL=void 0!==o,this.target=t,this.width=r>=1?r:1,this.height=n>=1?n:1,this.x=e,this.y=i,this.scale=s,this.update()},i.prototype.update=function(t){if(!this.target)throw"define() must be called before update()";var e=i.getFilterBounds(this.target),r=this.target.cacheCanvas;this._drawWidth=Math.ceil(this.width*this.scale)+e.width,this._drawHeight=Math.ceil(this.height*this.scale)+e.height,r&&this._drawWidth==r.width&&this._drawHeight==r.height||this._updateSurface(),this._filterOffX=e.x,this._filterOffY=e.y,this.offX=this.x*this.scale+this._filterOffX,this.offY=this.y*this.scale+this._filterOffY,this._drawToCache(t),this.cacheID=this.cacheID?this.cacheID+1:1},i.prototype.release=function(){var t=this.target.stage;this._useWebGL&&this._webGLCache?(this._webGLCache.isCacheControlled||(this.__lastRT&&(this.__lastRT=void 0),this.__rtA&&this._webGLCache._killTextureObject(this.__rtA),this.__rtB&&this._webGLCache._killTextureObject(this.__rtB),this.target&&this.target.cacheCanvas&&this._webGLCache._killTextureObject(this.target.cacheCanvas)),this._webGLCache=!1):t instanceof T&&(t.releaseTexture(this.target.cacheCanvas),this.target.cacheCanvas.remove()),this.target=this.target.cacheCanvas=null,this.cacheID=this._cacheDataURLID=this._cacheDataURL=void 0,this.width=this.height=this.x=this.y=this.offX=this.offY=0,this.scale=1},i.prototype.getCacheDataURL=function(){var t=this.target&&this.target.cacheCanvas;return t?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURLID=this.cacheID,this._cacheDataURL=t.toDataURL?t.toDataURL():null),this._cacheDataURL):null},i.prototype.draw=function(t){return!!this.target&&(t.drawImage(this.target.cacheCanvas,this.x+this._filterOffX,this.y+this._filterOffY,this.width,this.height),!0)},i.prototype._updateSurface=function(){if(!this._useWebGL){var t=this.target.cacheCanvas;return t||(t=this.target.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),t.width=this._drawWidth,void(t.height=this._drawHeight)}if(!this._webGLCache)if(this._options===!0||this.target.stage!==this._options)this.target.cacheCanvas=document.createElement("canvas"),this._webGLCache=new T(this.target.cacheCanvas,{}),this._webGLCache.isCacheControlled=!0;else try{this.target.cacheCanvas=!0,this._webGLCache=this._options}catch(t){throw"Invalid StageGL object used for cache parameter."}var e=this._webGLCache,i=this.target.cacheCanvas;e.isCacheControlled&&(i.width=this._drawWidth,i.height=this._drawHeight,e.updateViewport(this._drawWidth,this._drawHeight)),this.target.filters?(e.getTargetRenderTexture(this.target,this._drawWidth,this._drawHeight),e.getTargetRenderTexture(this.target,this._drawWidth,this._drawHeight)):e.isCacheControlled||e.getTargetRenderTexture(this.target,this._drawWidth,this._drawHeight)},i.prototype._drawToCache=function(t){var e=this.target,i=e.cacheCanvas,r=this._webGLCache;if(!this._useWebGL||!r){var n=i.getContext("2d");return t||n.clearRect(0,0,this._drawWidth+1,this._drawHeight+1),n.save(),n.globalCompositeOperation=t,n.setTransform(this.scale,0,0,this.scale,-this.offX,-this.offY),e.draw(n,!0),n.restore(),e.filters&&e.filters.length&&this._applyFilters(e),void(i._invalid=!0)}this._webGLCache.cacheDraw(e,e.filters,this),i=this.target.cacheCanvas,i.width=this._drawWidth,i.height=this._drawHeight,i._invalid=!0},i.prototype._applyFilters=function(){for(var t=this.target.cacheCanvas,e=this.target.filters,i=t.width,r=t.height,n=t.getContext("2d").getImageData(0,0,i,r),s=e.length,o=0;o<s;o++)e[o]._applyFilter(n);t.getContext("2d").putImageData(n,0,0)},i}(v),m=function(t){function i(){e(this,i);var r=s(this,t.call(this));return r.alpha=1,r.cacheCanvas=null,r.bitmapCache=null,r.id=c.get(),r.mouseEnabled=!0,r.tickEnabled=!0,r.name=null,r.parent=null,r.regX=0,r.regY=0,r.rotation=0,r.scaleX=1,r.scaleY=1,r.skewX=0,r.skewY=0,r.shadow=null,r.visible=!0,r.x=0,r.y=0,r.transformMatrix=null,r.compositeOperation=null,r.snapToPixel=!0,r.filters=null,r.mask=null,r.hitArea=null,r.cursor=null,r._props=new _,r._rectangle=new f,r._bounds=null,r}return n(i,t),i.prototype.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},i.prototype.draw=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.drawCache(t,e)},i.prototype.drawCache=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.bitmapCache;return!(!i||e)&&i.draw(t)},i.prototype.updateContext=function(t){var e=this,r=e.mask,n=e._props.matrix;r&&r.graphics&&!r.graphics.isEmpty()&&(r.getMatrix(n),t.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),r.graphics.drawAsPath(t),t.clip(),n.invert(),t.transform(n.a,n.b,n.c,n.d,n.tx,n.ty)),this.getMatrix(n);var s=n.tx,o=n.ty;i._snapToPixelEnabled&&e.snapToPixel&&(s=s+(s<0?-.5:.5)|0,o=o+(o<0?-.5:.5)|0),t.transform(n.a,n.b,n.c,n.d,s,o),t.globalAlpha*=e.alpha,e.compositeOperation&&(t.globalCompositeOperation=e.compositeOperation),e.shadow&&this._applyShadow(t,e.shadow)},i.prototype.cache=function(t,e,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments[5];this.bitmapCache||(this.bitmapCache=new g),this.bitmapCache.define(this,t,e,i,r,n,s)},i.prototype.updateCache=function(t){if(!this.bitmapCache)throw"cache() must be called before updateCache()";this.bitmapCache.update(t)},i.prototype.uncache=function(){this.bitmapCache&&(this.bitmapCache.release(),this.bitmapCache=void 0)},i.prototype.getCacheDataURL=function(){return this.bitmapCache?this.bitmapCache.getDataURL():null},i.prototype.localToGlobal=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p;return this.getConcatenatedMatrix(this._props.matrix).transformPoint(t,e,i)},i.prototype.globalToLocal=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p;return this.getConcatenatedMatrix(this._props.matrix).invert().transformPoint(t,e,i)},i.prototype.localToLocal=function(t,e,i,r){return r=this.localToGlobal(t,e,r),i.globalToLocal(r.x,r.y,r)},i.prototype.setTransform=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return this.x=t,this.y=e,this.scaleX=i,this.scaleY=r,this.rotation=n,this.skewX=s,this.skewY=o,this.regX=a,this.regY=h,this},i.prototype.getMatrix=function(t){var e=this,i=t&&t.identity()||new d;return e.transformMatrix?i.copy(e.transformMatrix):i.appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY)},i.prototype.getConcatenatedMatrix=function(t){for(var e=this,i=this.getMatrix(t);e=e.parent;)i.prependMatrix(e.getMatrix(e._props.matrix));return i},i.prototype.getConcatenatedDisplayProps=function(t){t=t?t.identity():new _;var e=this,i=e.getMatrix(t.matrix);do t.prepend(e.visible,e.alpha,e.shadow,e.compositeOperation),e!=this&&i.prependMatrix(e.getMatrix(e._props.matrix));while(e=e.parent);return t},i.prototype.hitTest=function(t,e){var r=i._hitTestContext;r.setTransform(1,0,0,1,-t,-e),this.draw(r);var n=this._testHit(r);return r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,2,2),n},i.prototype.set=function(t){for(var e in t)this[e]=t[e];return this},i.prototype.getBounds=function(){if(this._bounds)return this._rectangle.copy(this._bounds);var t=this.cacheCanvas;if(t){var e=this._cacheScale;return this._rectangle.setValues(this._cacheOffsetX,this._cacheOffsetY,t.width/e,t.height/e)}return null},i.prototype.getTransformedBounds=function(){return this._getBounds()},i.prototype.setBounds=function(t,e,i,r){null==t&&(this._bounds=t),this._bounds=(this._bounds||new f).setValues(t,e,i,r)},i.prototype.clone=function(){return this._cloneProps(new i)},i.prototype.toString=function(){return"["+this.constructor.name+(this.name?" (name="+this.name+")":"")+"]"},i.prototype._cloneProps=function(t){return t.alpha=this.alpha,t.mouseEnabled=this.mouseEnabled,t.tickEnabled=this.tickEnabled,t.name=this.name,t.regX=this.regX,t.regY=this.regY,t.rotation=this.rotation,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.shadow=this.shadow,t.skewX=this.skewX,t.skewY=this.skewY,t.visible=this.visible,t.x=this.x,t.y=this.y,t.compositeOperation=this.compositeOperation,t.snapToPixel=this.snapToPixel,t.filters=null==this.filters?null:this.filters.slice(0),t.mask=this.mask,t.hitArea=this.hitArea,t.cursor=this.cursor,t._bounds=this._bounds,t},i.prototype._applyShadow=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Shadow.identity;e=e,t.shadowColor=e.color,t.shadowOffsetX=e.offsetX,t.shadowOffsetY=e.offsetY,t.shadowBlur=e.blur},i.prototype._tick=function(t){var e=this._listeners;e&&e.tick&&(t.target=null,t.propagationStopped=t.immediatePropagationStopped=!1,this.dispatchEvent(t))},i.prototype._testHit=function(t){try{return t.getImageData(0,0,1,1).data[3]>1}catch(t){if(!i.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images.";return!1}},i.prototype._getBounds=function(t,e){return this._transformBounds(this.getBounds(),t,e)},i.prototype._transformBounds=function(t,e,i){if(!t)return t;var r=t.x,n=t.y,s=t.width,o=t.height,a=this._props.matrix;a=i?a.identity():this.getMatrix(a),(r||n)&&a.appendTransform(0,0,1,1,0,0,0,-r,-n),e&&a.prependMatrix(e);var h=s*a.a,u=s*a.b,l=o*a.c,c=o*a.d,p=a.tx,d=a.ty,_=p,f=p,v=d,g=d;return(r=h+p)<_?_=r:r>f&&(f=r),(r=h+l+p)<_?_=r:r>f&&(f=r),(r=l+p)<_?_=r:r>f&&(f=r),(n=u+d)<v?v=n:n>g&&(g=n),(n=u+c+d)<v?v=n:n>g&&(g=n),(n=c+d)<v?v=n:n>g&&(g=n),t.setValues(_,v,f-_,g-v)},i.prototype._hasMouseEventListener=function(){for(var t=i._MOUSE_EVENTS,e=0,r=t.length;e<r;e++)if(this.hasEventListener(t[e]))return!0;return!!this.cursor},r(i,[{key:"stage",get:function(){for(var t=this;t.parent;)t=t.parent;return/^\[Stage(GL)?(\s\(name=\w+\))?\]$/.test(t.toString())?t:null}}]),i}(a),y=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");y.getContext&&(m._hitTestCanvas=y,m._hitTestContext=y.getContext("2d"),y.width=y.height=1),m._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"],m.suppressCrossDomainErrors=!1,m.snapToPixelEnabled=!1;var x=function(t){function i(){e(this,i);var r=s(this,t.call(this));return r.children=[],r.mouseChildren=!0,r.tickChildren=!0,r}return n(i,t),i.prototype.isVisible=function(){var t=this.cacheCanvas||this.children.length;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},i.prototype.draw=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.prototype.draw.call(this,e,i))return!0;for(var r=this.children.slice(),n=0,s=r.length;n<s;n++){var o=r[n];o.isVisible()&&(e.save(),o.updateContext(e),o.draw(e),e.restore())}return!0},i.prototype.addChild=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.length;if(0==r)return null;var n=e[0];if(r>1){for(var s=0;s<r;s++)n=this.addChild(e[s]);return n}return n.parent&&n.parent.removeChild(n),n.parent=this,this.children.push(n),n.dispatchEvent("added"),n},i.prototype.addChildAt=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.pop(),n=e.length;if(r<0||r>this.children.length)return e[n-2];if(n>2){for(var s=0;s<n-1;s++)this.addChildAt(e[s],r++);return e[n-2]}var o=e[0];return o.parent&&o.parent.removeChild(o),o.parent=this,this.children.splice(r++,0,o),o.dispatchEvent("added"),o},i.prototype.removeChild=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.length;if(r>1){for(var n=!0,s=0;s<r;s++)n=n&&this.removeChild(e[s]);return n}return this.removeChildAt(this.children.indexOf(e[0]))},i.prototype.removeChildAt=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.length;if(r>1){e.sort(function(t,e){return e-t});for(var n=!0,s=0;s<r;s++)n=n&&this.removeChildAt(e[s]);return n}var o=e[0];if(o<0||o>this.children.length-1)return!1;var a=this.children[o];return a&&(a.parent=null),this.children.splice(o,1),a.dispatchEvent("removed"),!0},i.prototype.removeAllChildren=function(){for(var t=this.children;t.length;)this.removeChildAt(0)},i.prototype.getChildAt=function(t){
return this.children[t]},i.prototype.getChildByName=function(t){for(var e=this.children,i=e.length,r=0;r<i;r++)if(e[r].name==t)return e[r];return null},i.prototype.sortChildren=function(t){this.children.sort(t)},i.prototype.getChildIndex=function(t){return this.children.indexOf(t)},i.prototype.swapChildrenAt=function(t,e){var i=this.children,r=i[t],n=i[e];r&&n&&(i[t]=n,i[e]=r)},i.prototype.swapChildren=function(t,e){for(var i=this.children,r=i.length,n=void 0,s=void 0,o=0;o<r&&(i[o]==t&&(n=o),i[o]==e&&(s=o),null==n||null==s);o++);o!=r&&(i[n]=e,i[s]=t)},i.prototype.setChildIndex=function(t,e){var i=this.children,r=i.length;if(!(t.parent!=this||e<0||e>=r)){for(var n=0;n<r&&i[n]!=t;n++);n!=r&&n!=e&&(i.splice(n,1),i.splice(e,0,t))}},i.prototype.contains=function(t){for(;t;){if(t==this)return!0;t=t.parent}return!1},i.prototype.hitTest=function(t,e){return null!=this.getObjectUnderPoint(t,e)},i.prototype.getObjectsUnderPoint=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[],n=this.localToGlobal(t,e);return this._getObjectsUnderPoint(n.x,n.y,r,i>0,1==i),r},i.prototype.getObjectUnderPoint=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.localToGlobal(t,e);return this._getObjectsUnderPoint(r.x,r.y,null,i>0,1==i)},i.prototype.getBounds=function(){return this._getBounds(null,!0)},i.prototype.getTransformedBounds=function(){return this._getBounds()},i.prototype.clone=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this._cloneProps(new i);return t&&this._cloneChildren(e),e},i.prototype._tick=function(e){if(this.tickChildren)for(var i=this.children.length-1;i>=0;i--){var r=this.children[i];r.tickEnabled&&r._tick&&r._tick(e)}t.prototype._tick.call(this,e)},i.prototype._cloneChildren=function(t){t.children.length&&t.removeAllChildren();for(var e=t.children,i=this.children.length,r=0;r<i;r++){var n=this.children[r].clone(!0);n.parent=t,e.push(n)}},i.prototype._getObjectsUnderPoint=function(t,e,r,n,s){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!o&&!this._testMask(this,t,e))return null;var a=void 0,h=m._hitTestContext;s=s||n&&this._hasMouseEventListener();for(var u=this.children,l=u.length,c=l-1;c>=0;c--){var p=u[c],d=p.hitArea;if(p.visible&&(d||p.isVisible())&&(!n||p.mouseEnabled)&&(d||this._testMask(p,t,e)))if(!d&&p instanceof i){var _=p._getObjectsUnderPoint(t,e,r,n,s,o+1);if(!r&&_)return n&&!this.mouseChildren?this:_}else{if(n&&!s&&!p._hasMouseEventListener())continue;var f=p.getConcatenatedDisplayProps(p._props);if(a=f.matrix,d&&(a.appendMatrix(d.getMatrix(d._props.matrix)),f.alpha=d.alpha),h.globalAlpha=f.alpha,h.setTransform(a.a,a.b,a.c,a.d,a.tx-t,a.ty-e),(d||p).draw(h),!this._testHit(h))continue;if(h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,2,2),!r)return n&&!this.mouseChildren?this:p;r.push(p)}}return null},i.prototype._testMask=function(t,e,i){var r=t.mask;if(!r||!r.graphics||r.graphics.isEmpty())return!0;var n=this._props.matrix,s=t.parent;n=s?s.getConcatenatedMatrix(n):n.identity(),n=r.getMatrix(r._props.matrix).prependMatrix(n);var o=m._hitTestContext;return o.setTransform(n.a,n.b,n.c,n.d,n.tx-e,n.ty-i),r.graphics.drawAsPath(o),o.fillStyle="#000",o.fill(),!!this._testHit(o)&&(o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,2,2),!0)},i.prototype._getBounds=function(e,i){var r=t.prototype.getBounds.call(this);if(r)return this._transformBounds(r,e,i);var n=this._props.matrix;n=i?n.identity():this.getMatrix(n),e&&n.prependMatrix(e);for(var s=this.children.length,o=null,a=0;a<s;a++){var h=this.children[a];h.visible&&(r=h._getBounds(n))&&(o?o.extend(r.x,r.y,r.width,r.height):o=r.clone())}return o},r(i,[{key:"numChildren",get:function(){return this.children.length}}]),i}(m),w=function(t){function i(r,n,o,a,h,u,l,c,p,d,_){e(this,i);var f=s(this,t.call(this,r,n,o));return f.stageX=a,f.stageY=h,f.rawX=null==p?a:p,f.rawY=null==d?h:d,f.nativeEvent=u,f.pointerID=l,f.primary=!!c,f.relatedTarget=_,f}return n(i,t),i.prototype.clone=function(){return new i(this.type,this.bubbles,this.cancelable,this.stageX,this.stageY,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)},i.prototype.toString=function(){return"["+this.constructor.name+" (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},r(i,[{key:"localX",get:function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).x}},{key:"localY",get:function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).y}},{key:"isTouch",get:function(){return this.pointerID!==-1}}]),i}(o),b=function(t){function i(r){e(this,i);var n=s(this,t.call(this));return n.autoClear=!0,n.canvas="string"==typeof r?document.getElementById(r):r,n.mouseX=0,n.mouseY=0,n.drawRect=null,n.snapToPixelEnabled=!1,n.mouseInBounds=!1,n.tickOnUpdate=!0,n.mouseMoveOutside=!1,n.preventSelection=!0,n._pointerData={},n._pointerCount=0,n._primaryPointerID=null,n._mouseOverIntervalID=null,n._nextStage=null,n._prevStage=null,n.enableDOMEvents(!0),n}return n(i,t),i.prototype.update=function(t){if(this.canvas&&(this.tickOnUpdate&&this.tick(t),this.dispatchEvent("drawstart",!1,!0)!==!1)){m._snapToPixelEnabled=this.snapToPixelEnabled;var e=this.drawRect,i=this.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),this.autoClear&&(e?i.clearRect(e.x,e.y,e.width,e.height):i.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)),i.save(),this.drawRect&&(i.beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip()),this.updateContext(i),this.draw(i,!1),i.restore(),this.dispatchEvent("drawend")}},i.prototype.tick=function(t){if(this.tickEnabled&&this.dispatchEvent("tickstart",!1,!0)!==!1){var e=new o("tick");if(t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);this._tick(e),this.dispatchEvent("tickend")}},i.prototype.handleEvent=function(t){"tick"==t.type&&this.update(t)},i.prototype.clear=function(){if(this.canvas){var t=this.canvas.getContext("2d");t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}},i.prototype.toDataURL=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",i=void 0,r=this.canvas.getContext("2d"),n=this.canvas.width,s=this.canvas.height;if(t){i=r.getImageData(0,0,n,s);var o=r.globalCompositeOperation;r.globalCompositeOperation="destination-over",r.fillStyle=t,r.fillRect(0,0,n,s)}var a=this.canvas.toDataURL(e);return t&&(r.putImageData(i,0,0),r.globalCompositeOperation=o),a},i.prototype.enableMouseOver=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null,0==e&&this._testMouseOver(!0)),e<=0||(this._mouseOverIntervalID=setInterval(function(){return t._testMouseOver()},1e3/Math.min(50,e)))},i.prototype.enableDOMEvents=function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this._eventListeners;if(!e&&i){for(var r in i){var n=i[r];n.t.removeEventListener(r,n.f,!1)}this._eventListeners=null}else if(e&&!i&&this.canvas){var s=window.addEventListener?window:document;i=this._eventListeners={mouseup:{t:s,f:function(e){return t._handleMouseUp(e)}},mousemove:{t:s,f:function(e){return t._handleMouseMove(e)}},dblclick:{t:this.canvas,f:function(e){return t._handleDoubleClick(e)}},mousedown:{t:this.canvas,f:function(e){return t._handleMouseDown(e)}}};for(var o in i){var a=i[o];a.t.addEventListener(o,a.f,!1)}}},i.prototype.clone=function(){throw"Stage cannot be cloned."},i.prototype._getElementRect=function(t){var e=void 0;try{e=t.getBoundingClientRect()}catch(i){e={top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}var i=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),r=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),n=window.getComputedStyle?getComputedStyle(t,null):t.currentStyle,s=parseInt(n.paddingLeft)+parseInt(n.borderLeftWidth),o=parseInt(n.paddingTop)+parseInt(n.borderTopWidth),a=parseInt(n.paddingRight)+parseInt(n.borderRightWidth),h=parseInt(n.paddingBottom)+parseInt(n.borderBottomWidth);return{left:e.left+i+s,right:e.right+i-a,top:e.top+r+o,bottom:e.bottom+r-h}},i.prototype._getPointerData=function(t){var e=this._pointerData[t];return e||(e=this._pointerData[t]={x:0,y:0}),e},i.prototype._handleMouseMove=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;this._handlePointerMove(-1,t,t.pageX,t.pageY)},i.prototype._handlePointerMove=function(t,e,i,r,n){if((!this._prevStage||void 0!==n)&&this.canvas){var s=this._nextStage,o=this._getPointerData(t),a=o.inBounds;this._updatePointerPosition(t,e,i,r),(a||o.inBounds||this.mouseMoveOutside)&&(t===-1&&o.inBounds==!a&&this._dispatchMouseEvent(this,a?"mouseleave":"mouseenter",!1,t,o,e),this._dispatchMouseEvent(this,"stagemousemove",!1,t,o,e),this._dispatchMouseEvent(o.target,"pressmove",!0,t,o,e)),s&&s._handlePointerMove(t,e,i,r,null)}},i.prototype._updatePointerPosition=function(t,e,i,r){var n=this._getElementRect(this.canvas);i-=n.left,r-=n.top;var s=this.canvas.width,o=this.canvas.height;i/=(n.right-n.left)/s,r/=(n.bottom-n.top)/o;var a=this._getPointerData(t);(a.inBounds=i>=0&&r>=0&&i<=s-1&&r<=o-1)?(a.x=i,a.y=r):this.mouseMoveOutside&&(a.x=i<0?0:i>s-1?s-1:i,a.y=r<0?0:r>o-1?o-1:r),a.posEvtObj=e,a.rawX=i,a.rawY=r,t!==this._primaryPointerID&&t!==-1||(this.mouseX=a.x,this.mouseY=a.y,this.mouseInBounds=a.inBounds)},i.prototype._handleMouseUp=function(t){this._handlePointerUp(-1,t,!1)},i.prototype._handlePointerUp=function(t,e,i,r){var n=this._nextStage,s=this._getPointerData(t);if(!this._prevStage||void 0!==r){var o=null,a=s.target;r||!a&&!n||(o=this._getObjectsUnderPoint(s.x,s.y,null,!0)),s.down&&(this._dispatchMouseEvent(this,"stagemouseup",!1,t,s,e,o),s.down=!1),o==a&&this._dispatchMouseEvent(a,"click",!0,t,s,e),this._dispatchMouseEvent(a,"pressup",!0,t,s,e),i?(t==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[t]):s.target=null,n&&n._handlePointerUp(t,e,i,r||o&&this)}},i.prototype._handleMouseDown=function(t){this._handlePointerDown(-1,t,t.pageX,t.pageY)},i.prototype._handlePointerDown=function(t,e,i,r,n){this.preventSelection&&e.preventDefault(),null!=this._primaryPointerID&&t!==-1||(this._primaryPointerID=t),null!=r&&this._updatePointerPosition(t,e,i,r);var s=null,o=this._nextStage,a=this._getPointerData(t);n||(s=a.target=this._getObjectsUnderPoint(a.x,a.y,null,!0)),a.inBounds&&(this._dispatchMouseEvent(this,"stagemousedown",!1,t,a,e,s),a.down=!0),this._dispatchMouseEvent(s,"mousedown",!0,t,a,e),o&&o._handlePointerDown(t,e,i,r,n||s&&this)},i.prototype._testMouseOver=function(t,e,i){if(!this._prevStage||void 0!==e){var r=this._nextStage;if(!this._mouseOverIntervalID)return void(r&&r._testMouseOver(t,e,i));var n=this._getPointerData(-1);if(n&&(t||this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var s=n.posEvtObj,o=i||s&&s.target==this.canvas,a=null,h=-1,u="";!e&&(t||this.mouseInBounds&&o)&&(a=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,!0),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);for(var l=this._mouseOverTarget||[],c=l[l.length-1],p=this._mouseOverTarget=[],d=a;d;)p.unshift(d),u||(u=d.cursor),d=d.parent;this.canvas.style.cursor=u,!e&&i&&(i.canvas.style.cursor=u);for(var _=0,f=p.length;_<f&&p[_]==l[_];_++)h=_;c!=a&&this._dispatchMouseEvent(c,"mouseout",!0,-1,n,s,a);for(var v=l.length-1;v>h;v--)this._dispatchMouseEvent(l[v],"rollout",!1,-1,n,s,a);for(var g=p.length-1;g>h;g--)this._dispatchMouseEvent(p[g],"rollover",!1,-1,n,s,c);c!=a&&this._dispatchMouseEvent(a,"mouseover",!0,-1,n,s,c),r&&r._testMouseOver(t,e||a&&this,i||o&&this)}}},i.prototype._handleDoubleClick=function(t,e){var i=null,r=this._nextStage,n=this._getPointerData(-1);e||(i=this._getObjectsUnderPoint(n.x,n.y,null,!0),this._dispatchMouseEvent(i,"dblclick",!0,-1,n,t)),r&&r._handleDoubleClick(t,e||i&&this)},i.prototype._dispatchMouseEvent=function(t,e,i,r,n,s,o){if(t&&(i||t.hasEventListener(e))){var a=new w(e,i,(!1),n.x,n.y,s,r,r===this._primaryPointerID||r===-1,n.rawX,n.rawY,o);t.dispatchEvent(a)}},r(i,[{key:"nextStage",get:function(){return this._nextStage},set:function(t){this._nextStage&&(this._nextStage._prevStage=null),t&&(t._prevStage=this),this._nextStage=t}}]),i}(x),T=function(t){function i(r,n){var o=n.preserveBuffer,a=void 0!==o&&o,h=n.antialias,u=void 0!==h&&h,l=n.transparent,c=void 0!==l&&l,p=n.premultiply,d=void 0!==p&&p,_=n.autoPurge,f=void 0===_?1200:_;e(this,i);var v=s(this,t.call(this,r));return v.vocalDebug=!1,v._preserveBuffer=a,v._antialias=u,v._transparent=c,v._premultiply=d,v._autoPurge=f,v._viewportWidth=0,v._viewportHeight=0,v._projectionMatrix=null,v._webGLContext=null,v._clearColor={r:0,g:0,b:0,a:0},v._maxCardsPerBatch=i.DEFAULT_MAX_BATCH_SIZE,v._activeShader=null,v._vertices=null,v._vertexPositionBuffer=null,v._uvs=null,v._uvPositionBuffer=null,v._indices=null,v._textureIndexBuffer=null,v._alphas=null,v._alphaBuffer=null,v._textureDictionary=[],v._textureIDs={},v._batchTextures=[],v._baseTextures=[],v._batchTextureCount=8,v._lastTextureInsert=-1,v._batchID=0,v._drawID=0,v._slotBlacklist=[],v._isDrawing=0,v._lastTrackedCanvas=0,v.isCacheControlled=!1,v._cacheContainer=new x,v._initializeWebGL(),v}return n(i,t),i.buildUVRects=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t||!t._frames)return null;for(var n=e!=-1&&r?e:0,s=e!=-1&&r?e+1:t._frames.length,o=n;o<s;o++){var a=t._frames[o];if(!(a.uvRect||a.image.width<=0||a.image.height<=0)){var h=a.rect;a.uvRect={t:h.y/a.image.height,l:h.x/a.image.width,b:(h.y+h.height)/a.image.height,r:(h.x+h.width)/a.image.width}}}var u=i.UV_RECT;return t._frames[e!=-1?e:0].uvRect||{t:u.t,l:u.l,b:u.b,r:u.r}},i.isWebGLActive=function(t){return t&&t instanceof WebGLRenderingContext&&"undefined"!=typeof WebGLRenderingContext},i.prototype._initializeWebGL=function(){if(this.canvas){if(!this._webGLContext||this._webGLContext.canvas!==this.canvas){var t={depth:!1,alpha:this._transparent,stencil:!0,antialias:this._antialias,premultipliedAlpha:this._premultiply,preserveDrawingBuffer:this._preserveBuffer},e=this._webGLContext=this._fetchWebGLContext(this.canvas,t);if(!e)return null;this.updateSimultaneousTextureCount(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)),this._maxTextureSlots=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this._createBuffers(e),this._initTextures(e),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiply),this.setClearColor(),this.updateViewport(this._viewportWidth||this.canvas.width,this._viewportHeight||this.canvas.height)}}else this._webGLContext=null;return this._webGLContext},i.prototype.update=function(t){if(this.canvas){if(this.tickOnUpdate&&this.tick(t),this.dispatchEvent("drawstart"),this.autoClear&&this.clear(),this._webGLContext)this._batchDraw(this,this._webGLContext),this._autoPurge==-1||this._drawID%(this._autoPurge/2|0)||this.purgeTextures(this._autoPurge);else{var e=this.canvas.getContext("2d");e.save(),this.updateContext(e),this.draw(e,!1),e.restore()}this.dispatchEvent("drawend")}},i.prototype.clear=function(){if(this.canvas)if(i.isWebGLActive(this._webGLContext)){var t=this._webGLContext;t.clear(t.COLOR_BUFFER_BIT)}else{var e=this.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}},i.prototype.draw=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e===this._webGLContext&&i.isWebGLActive(this._webGLContext)){var n=this._webGLContext;return this._batchDraw(this,n,r),!0}return t.prototype.draw.call(this,e,r)},i.prototype.cacheDraw=function(t,e,r){return!!i.isWebGLActive(this._webGLContext)&&(this._cacheDraw(t,e,r),!0)},i.prototype.protectTextureSlot=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t>this._maxTextureSlots||t<0)throw"Slot outside of acceptable range";this._slotBlacklist[t]=!!e},i.prototype.getTargetRenderTexture=function(t,e,i){var r=void 0,n=!1,s=this._webGLContext;if(void 0!==t.__lastRT&&t.__lastRT===t.__rtA&&(n=!0),n?(void 0===t.__rtB?t.__rtB=this.getRenderBufferTexture(e,i):(e==t.__rtB._width&&i==t.__rtB._height||this.resizeTexture(t.__rtB,e,i),this.setTextureParams(s)),r=t.__rtB):(void 0===t.__rtA?t.__rtA=this.getRenderBufferTexture(e,i):(e==t.__rtA._width&&i==t.__rtA._height||this.resizeTexture(t.__rtA,e,i),this.setTextureParams(s)),r=t.__rtA),!r)throw"Problems creating render textures, known causes include using too much VRAM by not releasing WebGL texture instances";return t.__lastRT=r,r},i.prototype.releaseTexture=function(t){if(t){if(t.children)for(var e=0,i=t.children.length;e<i;e++)this.releaseTexture(t.children[e]);t.cacheCanvas&&t.uncache();var r=void 0;if(void 0!==t._storeID){if(t===this._textureDictionary[t._storeID])return this._killTextureObject(t),void(t._storeID=void 0);r=t}else if(2===t._webGLRenderStyle)r=t.image;else if(1===t._webGLRenderStyle){for(var n=0,s=t.spriteSheet._images.length;n<s;n++)this.releaseTexture(t.spriteSheet._images[n]);return}if(void 0===r)return void(this.vocalDebug&&console.log("No associated texture found on release"));this._killTextureObject(this._textureDictionary[r._storeID]),r._storeID=void 0}},i.prototype.purgeTextures=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,e=this._textureDictionary,i=e.length,r=0;r<i;r++){var n=e[r];n&&n._drawID+t<=this._drawID&&this._killTextureObject(n)}},i.prototype.updateSimultaneousTextureCount=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this._webGLContext,i=!1;for(t<1&&(t=1),this._batchTextureCount=t;!i;)try{this._activeShader=this._fetchShaderProgram(e),i=!0}catch(t){if(1==this._batchTextureCount)throw"Cannot compile shader "+t;this._batchTextureCount-=4,this._batchTextureCount<1&&(this._batchTextureCount=1),this.vocalDebug&&console.log("Reducing desired texture count due to errors: "+this._batchTextureCount)}},i.prototype.updateViewport=function(t,e){this._viewportWidth=0|t,this._viewportHeight=0|e;var i=this._webGLContext;i&&(i.viewport(0,0,this._viewportWidth,this._viewportHeight),this._projectionMatrix=new Float32Array([2/this._viewportWidth,0,0,0,0,-2/this._viewportHeight,1,0,0,0,1,0,-1,1,.1,0]),this._projectionMatrixFlip=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this._projectionMatrixFlip.set(this._projectionMatrix),this._projectionMatrixFlip[5]*=-1,this._projectionMatrixFlip[13]*=-1)},i.prototype.getFilterShader=function(t){t||(t=this);var e=this._webGLContext,i=this._activeShader;if(t._builtShader)i=t._builtShader,i.shaderParamSetup&&i.shaderParamSetup(e,this,i);else try{i=this._fetchShaderProgram(e,"filter",t.VTX_SHADER_BODY,t.FRAG_SHADER_BODY,t.shaderParamSetup&&t.shaderParamSetup.bind(t)),t._builtShader=i,i._name=t.toString()}catch(t){console&&console.log(t)}return i},i.prototype.getBaseTexture=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=Math.ceil(t>0?t:1),r=Math.ceil(e>0?e:1),n=this._webGLContext,s=n.createTexture();return this.resizeTexture(s,i,r),this.setTextureParams(n,!1),s},i.prototype.resizeTexture=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=this._webGLContext;r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,i,0,r.RGBA,r.UNSIGNED_BYTE,null),t.width=e,t.height=i},i.prototype.getRenderBufferTexture=function(t,e){var i=this._webGLContext,r=this.getBaseTexture(t,e);if(!r)return null;var n=i.createFramebuffer();return n?(r.width=t,r.height=e,i.bindFramebuffer(i.FRAMEBUFFER,n),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,r,0),n._renderTexture=r,r._frameBuffer=n,r._storeID=this._textureDictionary.length,this._textureDictionary[r._storeID]=r,i.bindFramebuffer(i.FRAMEBUFFER,null),r):null},i.prototype.setTextureParams=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&this._antialias?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)},i.prototype.setClearColor=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=void 0,i=void 0,r=void 0,n=void 0,s=void 0;"string"==typeof t?0==t.indexOf("#")?(4==t.length&&(t="#"+(t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3))),e=Number("0x"+t.slice(1,3))/255,i=Number("0x"+t.slice(3,5))/255,r=Number("0x"+t.slice(5,7))/255,n=Number("0x"+t.slice(7,9))/255):0==t.indexOf("rgba(")&&(s=t.slice(5,-1).split(","),e=Number(s[0])/255,i=Number(s[1])/255,r=Number(s[2])/255,n=Number(s[3])):(e=((4278190080&t)>>>24)/255,i=((16711680&t)>>>16)/255,r=((65280&t)>>>8)/255,n=(255&t)/255),this._clearColor.r=e||0,this._clearColor.g=i||0,this._clearColor.b=r||0,this._clearColor.a=n||0,this._webGLContext&&this._webGLContext.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a)},i.prototype._fetchWebGLContext=function(t,e){var i=void 0;try{i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)}catch(t){}if(i)i.viewportWidth=t.width,i.viewportHeight=t.height;else{var r="Could not initialize WebGL";console.error?console.error(r):console.log(r)}return i},i.prototype._fetchShaderProgram=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular",r=arguments[2],n=arguments[3],s=arguments[4];t.useProgram(null);var o=void 0,a=void 0;switch(e){case"filter":a=i.COVER_VERTEX_HEADER+(r||i.COVER_VERTEX_BODY),o=i.COVER_FRAGMENT_HEADER+(n||i.COVER_FRAGMENT_BODY);break;case"particle":a=i.REGULAR_VERTEX_HEADER+i.PARTICLE_VERTEX_BODY,o=i.REGULAR_FRAGMENT_HEADER+i.PARTICLE_FRAGMENT_BODY;break;case"override":a=i.REGULAR_VERTEX_HEADER+(r||i.REGULAR_VERTEX_BODY),o=i.REGULAR_FRAGMENT_HEADER+(n||i.REGULAR_FRAGMENT_BODY);break;case"regular":default:a=i.REGULAR_VERTEX_HEADER+i.REGULAR_VERTEX_BODY,o=i.REGULAR_FRAGMENT_HEADER+i.REGULAR_FRAGMENT_BODY}var h=this._createShader(t,t.VERTEX_SHADER,a),u=this._createShader(t,t.FRAGMENT_SHADER,o),l=t.createProgram();if(t.attachShader(l,h),t.attachShader(l,u),t.linkProgram(l),l._type=e,!t.getProgramParameter(l,t.LINK_STATUS))throw t.useProgram(this._activeShader),t.getProgramInfoLog(l);switch(t.useProgram(l),e){case"filter":l.vertexPositionAttribute=t.getAttribLocation(l,"vertexPosition"),t.enableVertexAttribArray(l.vertexPositionAttribute),l.uvPositionAttribute=t.getAttribLocation(l,"uvPosition"),t.enableVertexAttribArray(l.uvPositionAttribute),l.samplerUniform=t.getUniformLocation(l,"uSampler"),t.uniform1i(l.samplerUniform,0),l.uprightUniform=t.getUniformLocation(l,"uUpright"),t.uniform1f(l.uprightUniform,0),s&&s(t,this,l);break;case"override":case"particle":case"regular":default:l.vertexPositionAttribute=t.getAttribLocation(l,"vertexPosition"),t.enableVertexAttribArray(l.vertexPositionAttribute),l.uvPositionAttribute=t.getAttribLocation(l,"uvPosition"),t.enableVertexAttribArray(l.uvPositionAttribute),l.textureIndexAttribute=t.getAttribLocation(l,"textureIndex"),t.enableVertexAttribArray(l.textureIndexAttribute),l.alphaAttribute=t.getAttribLocation(l,"objectAlpha"),t.enableVertexAttribArray(l.alphaAttribute);for(var c=[],p=0;p<this._batchTextureCount;p++)c[p]=p;l.samplerData=c,l.samplerUniform=t.getUniformLocation(l,"uSampler"),t.uniform1iv(l.samplerUniform,c),l.pMatrixUniform=t.getUniformLocation(l,"pMatrix")}return t.useProgram(this._activeShader),l},i.prototype._createShader=function(t,e,i){i=i.replace(/{{count}}/g,this._batchTextureCount);for(var r="",n=1;n<this._batchTextureCount;n++)r+="} else if (src == "+n+") { color = texture2D(uSampler["+n+"], vTextureCoord);";i=i.replace(/{{alternates}}/g,r).replace(/{{premultiply}}/g,this._premultiply?"/color.a":"");var s=t.createShader(e);if(t.shaderSource(s,i).compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw t.getShaderInfoLog(s);return s},i.prototype._createBuffers=function(t){var e=this._maxCardsPerBatch*i.INDICIES_PER_CARD,r=void 0,n=this._vertexPositionBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),r=2;for(var s=this._vertices=new Float32Array(e*r),o=0,a=s.length;o<a;o+=r)s[o]=s[o+1]=0;t.bufferData(t.ARRAY_BUFFER,s,t.DYNAMIC_DRAW),n.itemSize=r,n.numItems=e;var h=this._uvPositionBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),r=2;for(var u=this._uvs=new Float32Array(e*r),l=0,c=u.length;l<c;l+=r)u[l]=u[l+1]=0;t.bufferData(t.ARRAY_BUFFER,u,t.DYNAMIC_DRAW),h.itemSize=r,h.numItems=e;var p=this._textureIndexBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,p),r=1;for(var d=this._indices=new Float32Array(e*r),_=0,f=d.length;_<f;_++)d[_]=0;t.bufferData(t.ARRAY_BUFFER,d,t.DYNAMIC_DRAW),p.itemSize=r,p.numItems=e;var v=this._alphaBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,v),r=1;for(var g=this._alphas=new Float32Array(e*r),m=0,y=g.length;m<y;m++)g[m]=1;t.bufferData(t.ARRAY_BUFFER,g,t.DYNAMIC_DRAW),v.itemSize=r,v.numItems=e},i.prototype._initTextures=function(){this._lastTextureInsert=-1,this._textureDictionary=[],this._textureIDs={},this._baseTextures=[],this._batchTextures=[];for(var t=0;t<this._batchTextureCount;t++){var e=this.getBaseTexture();if(this._baseTextures[t]=this._batchTextures[t]=e,!e)throw"Problems creating basic textures, known causes include using too much VRAM by not releasing WebGL texture instances"}},i.prototype._loadTextureImage=function(t,e){var i=e.src;i||(e._isCanvas=!0,i=e.src="canvas_"+this._lastTrackedCanvas++);var r=this._textureIDs[i];void 0===r&&(r=this._textureIDs[i]=this._textureDictionary.length),void 0===this._textureDictionary[r]&&(this._textureDictionary[r]=this.getBaseTexture());var n=this._textureDictionary[r];if(n)n._batchID=this._batchID,n._storeID=r,n._imageData=e,this._insertTextureInBatch(t,n),e._storeID=r,e.complete||e.naturalWidth||e._isCanvas?this._updateTextureImageData(t,e):e.addEventListener("load",this._updateTextureImageData.bind(this,t,e));else{var s="Problems creating basic textures, known causes include using too much VRAM by not releasing WebGL texture instances";console.error&&console.error(s)||console.log(s),n=this._baseTextures[0],n._batchID=this._batchID,n._storeID=-1,n._imageData=n,this._insertTextureInBatch(t,n)}return n},i.prototype._updateTextureImageData=function(t,e){var i=e.width&e.width-1||e.height&e.height-1,r=this._textureDictionary[e._storeID];t.activeTexture(t.TEXTURE0+r._activeIndex),t.bindTexture(t.TEXTURE_2D,r),r.isPOT=!i,this.setTextureParams(t,r.isPOT);try{t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}catch(t){var n="\nAn error has occurred. This is most likely due to security restrictions on WebGL images with local or cross-domain origins";console.error?console.error(t,n):console&&console.log(t,n)}e._invalid=!1,r._w=e.width,r._h=e.height,this.vocalDebug&&(i&&console.warn("NPOT(Non Power of Two) Texture: "+e.src),(e.width>t.MAX_TEXTURE_SIZE||e.height>t.MAX_TEXTURE_SIZE)&&console&&console.error("Oversized Texture: "+e.width+"x"+e.height+" vs "+t.MAX_TEXTURE_SIZE+"max"))},i.prototype._insertTextureInBatch=function(t,e){if(this._batchTextures[e._activeIndex]!==e){var i=-1,r=(this._lastTextureInsert+1)%this._batchTextureCount,n=r;do{if(this._batchTextures[n]._batchID!=this._batchID&&!this._slotBlacklist[n]){i=n;break}n=(n+1)%this._batchTextureCount}while(n!==r);i===-1&&(this.batchReason="textureOverflow",this._drawBuffers(t),this.batchCardCount=0,i=r),this._batchTextures[i]=e,e._activeIndex=i;var s=e._imageData;s&&s._invalid&&void 0!==e._drawID?this._updateTextureImageData(t,s):(t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,e),this.setTextureParams(t)),this._lastTextureInsert=i}else{var o=e._imageData;void 0!=e._storeID&&o._invalid&&this._updateTextureImageData(t,o)}e._drawID=this._drawID,e._batchID=this._batchID},i.prototype._killTextureObject=function(t){if(t){var e=this._webGLContext;if(void 0!==t._storeID&&t._storeID>=0){this._textureDictionary[t._storeID]=void 0;for(var i in this._textureIDs)this._textureIDs[i]==t._storeID&&delete this._textureIDs[i];t._imageData._storeID=t._storeID=void 0}void 0!==t._activeIndex&&this._batchTextures[t._activeIndex]===t&&(this._batchTextures[t._activeIndex]=this._baseTextures[t._activeIndex]);try{t._frameBuffer&&e.deleteFramebuffer(t._frameBuffer),t._frameBuffer=void 0}catch(t){this.vocalDebug&&console.log(t)}try{e.deleteTexture(t)}catch(t){this.vocalDebug&&console.log(t)}}},i.prototype._backupBatchTextures=function(t,e){var i=this._webGLContext;this._backupTextures||(this._backupTextures=[]),void 0===e&&(e=this._backupTextures);for(var r=0;r<this._batchTextureCount;r++)i.activeTexture(i.TEXTURE0+r),t?this._batchTextures[r]=e[r]:(e[r]=this._batchTextures[r],this._batchTextures[r]=this._baseTextures[r]),i.bindTexture(i.TEXTURE_2D,this._batchTextures[r]),this.setTextureParams(i,this._batchTextures[r].isPOT);t&&e===this._backupTextures&&(this._backupTextures=[])},i.prototype._batchDraw=function(t,e,i){this._isDrawing>0&&this._drawBuffers(e),this._isDrawing++,this._drawID++,this.batchCardCount=0,this.depth=0,this._appendToBatchGroup(t,e,new d,this.alpha,i),this.batchReason="drawFinish",this._drawBuffers(e),this._isDrawing--},i.prototype._cacheDraw=function(t,e,i){var r=this._webGLContext,n=void 0,s=this._activeShader,o=this._slotBlacklist,a=this._maxTextureSlots-1,h=this._viewportWidth,u=this._viewportHeight;this.protectTextureSlot(a,!0);var l=t.getMatrix();l=l.clone(),l.scale(1/i.scale,1/i.scale),l=l.invert(),l.translate(-i.offX/i.scale,-i.offY/i.scale);var c=this._cacheContainer;c.children=[t],c.transformMatrix=l,this._backupBatchTextures(!1);var p=e&&e.length;p?this._drawFilters(t,e,i):this.isCacheControlled?(r.clear(r.COLOR_BUFFER_BIT),this._batchDraw(c,r,!0)):(r.activeTexture(r.TEXTURE0+a),t.cacheCanvas=this.getTargetRenderTexture(t,i._drawWidth,i._drawHeight),n=t.cacheCanvas,r.bindFramebuffer(r.FRAMEBUFFER,n._frameBuffer),this.updateViewport(i._drawWidth,i._drawHeight),this._projectionMatrix=this._projectionMatrixFlip,r.clear(r.COLOR_BUFFER_BIT),this._batchDraw(c,r,!0),r.bindFramebuffer(r.FRAMEBUFFER,null),this.updateViewport(h,u)),this._backupBatchTextures(!0),this.protectTextureSlot(a,!1),this._activeShader=s,this._slotBlacklist=o},i.prototype._drawFilters=function(t,e,i){var r=this._webGLContext,n=void 0,s=this._maxTextureSlots-1,o=this._viewportWidth,a=this._viewportHeight,h=this._cacheContainer,u=e&&e.length;r.activeTexture(r.TEXTURE0+s),n=this.getTargetRenderTexture(t,i._drawWidth,i._drawHeight),r.bindFramebuffer(r.FRAMEBUFFER,n._frameBuffer),this.updateViewport(i._drawWidth,i._drawHeight),r.clear(r.COLOR_BUFFER_BIT),this._batchDraw(h,r,!0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n),this.setTextureParams(r);for(var l=!1,c=0;c<u;c++){var p=e[c];this._activeShader=this.getFilterShader(p),this._activeShader&&(r.activeTexture(r.TEXTURE0+s),n=this.getTargetRenderTexture(t,i._drawWidth,i._drawHeight),r.bindFramebuffer(r.FRAMEBUFFER,n._frameBuffer),r.viewport(0,0,i._drawWidth,i._drawHeight),r.clear(r.COLOR_BUFFER_BIT),this._drawCover(r,l),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n),this.setTextureParams(r),u>1&&(l=!l))}this.isCacheControlled?(r.bindFramebuffer(r.FRAMEBUFFER,null),this.updateViewport(o,a),this._activeShader=this.getFilterShader(this),r.clear(r.COLOR_BUFFER_BIT),this._drawCover(r,l)):(l&&(r.activeTexture(r.TEXTURE0+s),n=this.getTargetRenderTexture(t,i._drawWidth,i._drawHeight),r.bindFramebuffer(r.FRAMEBUFFER,n._frameBuffer),this._activeShader=this.getFilterShader(this),r.viewport(0,0,i._drawWidth,i._drawHeight),r.clear(r.COLOR_BUFFER_BIT),
this._drawCover(r,!l)),r.bindFramebuffer(r.FRAMEBUFFER,null),this.updateViewport(o,a),t.cacheCanvas=n)},i.prototype._appendToBatchGroup=function(t,e,r,n,s){t._glMtx||(t._glMtx=new d);var o=t._glMtx;o.copy(r),t.transformMatrix?o.appendMatrix(t.transformMatrix):o.appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY);for(var a=void 0,h=void 0,u=void 0,l=void 0,c=t.numChildren,p=0;p<c;p++){var _=t.children[p];if(_.visible&&n)if(_.cacheCanvas&&!s||!_.children){this.batchCardCount+1>this._maxCardsPerBatch&&(this.batchReason="vertexOverflow",this._drawBuffers(e),this.batchCardCount=0),_._glMtx||(_._glMtx=new d);var f=_._glMtx;f.copy(o),_.transformMatrix?f.appendMatrix(_.transformMatrix):f.appendTransform(_.x,_.y,_.scaleX,_.scaleY,_.rotation,_.skewX,_.skewY,_.regX,_.regY);var v=void 0,g=void 0,m=void 0,y=void 0,x=void 0,w=void 0;if(2===_._webGLRenderStyle||_.cacheCanvas&&!s)m=!s&&_.cacheCanvas||_.image;else{if(1!==_._webGLRenderStyle)continue;y=_.spriteSheet.getFrame(_.currentFrame),m=y.image}var b=this._uvs,T=this._vertices,E=this._indices,R=this._alphas;if(m){if(void 0===m._storeID)x=this._loadTextureImage(e,m),this._insertTextureInBatch(e,x);else{if(x=this._textureDictionary[m._storeID],!x){this.vocalDebug&&console.log("Texture should not be looked up while not being stored.");continue}x._batchID!==this._batchID&&this._insertTextureInBatch(e,x)}if(g=x._activeIndex,2===_._webGLRenderStyle||_.cacheCanvas&&!s)_.sourceRect?(_._uvRect||(_._uvRect={}),w=_.sourceRect,v=_._uvRect,v.t=w.x/m.width,v.l=w.y/m.height,v.b=(w.x+w.width)/m.width,v.r=(w.y+w.height)/m.height,a=0,h=0,u=w.width+a,l=w.height+h):_.cacheCanvas?(w=_.bitmapCache,v=i.UV_RECT,a=w.x,h=w.y,u=w.width+a,l=w.height+h):(v=i.UV_RECT,a=0,h=0,u=m.width+a,l=m.height+h);else if(1===_._webGLRenderStyle){var A=y.rect;v=y.uvRect,v||(v=i.buildUVRects(_.spriteSheet,_.currentFrame,!1)),a=-y.regX,h=-y.regY,u=A.width-y.regX,l=A.height-y.regY}var C=this.batchCardCount*i.INDICIES_PER_CARD,D=2*C;T[D]=a*f.a+h*f.c+f.tx,T[D+1]=a*f.b+h*f.d+f.ty,T[D+2]=a*f.a+l*f.c+f.tx,T[D+3]=a*f.b+l*f.d+f.ty,T[D+4]=u*f.a+h*f.c+f.tx,T[D+5]=u*f.b+h*f.d+f.ty,T[D+6]=T[D+2],T[D+7]=T[D+3],T[D+8]=T[D+4],T[D+9]=T[D+5],T[D+10]=u*f.a+l*f.c+f.tx,T[D+11]=u*f.b+l*f.d+f.ty,b[D]=v.l,b[D+1]=v.t,b[D+2]=v.l,b[D+3]=v.b,b[D+4]=v.r,b[D+5]=v.t,b[D+6]=v.l,b[D+7]=v.b,b[D+8]=v.r,b[D+9]=v.t,b[D+10]=v.r,b[D+11]=v.b,E[C]=E[C+1]=E[C+2]=E[C+3]=E[C+4]=E[C+5]=g,R[C]=R[C+1]=R[C+2]=R[C+3]=R[C+4]=R[C+5]=_.alpha*n,this.batchCardCount++}}else this._appendToBatchGroup(_,e,o,_.alpha*n)}},i.prototype._drawBuffers=function(t){if(!(this.batchCardCount<=0)){this.vocalDebug&&console.log("Draw["+this._drawID+":"+this._batchID+"] : "+this.batchReason);var e=this._activeShader,r=this._vertexPositionBuffer,n=this._textureIndexBuffer,s=this._uvPositionBuffer,o=this._alphaBuffer;t.useProgram(e),t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(e.vertexPositionAttribute,r.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,this._vertices),t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribPointer(e.textureIndexAttribute,n.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,this._indices),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(e.uvPositionAttribute,s.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,this._uvs),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(e.alphaAttribute,o.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,this._alphas),t.uniformMatrix4fv(e.pMatrixUniform,t.FALSE,this._projectionMatrix);for(var a=0;a<this._batchTextureCount;a++){var h=this._batchTextures[a];t.activeTexture(t.TEXTURE0+a),t.bindTexture(t.TEXTURE_2D,h),this.setTextureParams(t,h.isPOT)}t.drawArrays(t.TRIANGLES,0,this.batchCardCount*i.INDICIES_PER_CARD),this._batchID++}},i.prototype._drawCover=function(t,e){this._isDrawing>0&&this._drawBuffers(t),this.vocalDebug&&console.log("Draw["+this._drawID+":"+this._batchID+"] : Cover");var r=this._activeShader,n=this._vertexPositionBuffer,s=this._uvPositionBuffer;t.clear(t.COLOR_BUFFER_BIT),t.useProgram(r),t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribPointer(r.vertexPositionAttribute,n.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,i.COVER_VERT),t.bindBuffer(t.ARRAY_BUFFER,s),t.vertexAttribPointer(r.uvPositionAttribute,s.itemSize,t.FLOAT,!1,0,0),t.bufferSubData(t.ARRAY_BUFFER,0,e?i.COVER_UV_FLIP:i.COVER_UV),t.uniform1i(r.samplerUniform,0),t.uniform1f(r.uprightUniform,e?0:1),t.drawArrays(t.TRIANGLES,0,i.INDICIES_PER_CARD)},r(i,[{key:"isWebGL",get:function(){return!!this._webGLContext}},{key:"autoPurge",get:function(){return Number(this._autoPurge)},set:function(t){t=isNaN(t)?1200:t,t!=-1&&t<10&&(t=10),this._autoPurge=t}}]),i}(b);T.VERTEX_PROPERTY_COUNT=6,T.INDICIES_PER_CARD=6,T.DEFAULT_MAX_BATCH_SIZE=1e4,T.WEBGL_MAX_INDEX_NUM=Math.pow(2,16),T.UV_RECT={t:0,l:0,b:1,r:1},T.COVER_VERT=new Float32Array([-1,1,1,1,-1,-1,1,1,1,-1,-1,-1]),T.COVER_UV=new Float32Array([0,0,1,0,0,1,1,0,1,1,0,1]),T.COVER_UV_FLIP=new Float32Array([0,1,1,1,0,0,1,1,1,0,0,0]),T.REGULAR_VARYING_HEADER="\n\t\tprecision mediump float;\n\t\tvarying vec2 vTextureCoord;\n\t\tvarying lowp float indexPicker;\n\t\tvarying lowp float alphaValue;\n\t",T.REGULAR_VERTEX_HEADER="\n\t\t"+T.REGULAR_VARYING_HEADER+"\n\t\tattribute vec2 vertexPosition;\n\t\tattribute vec2 uvPosition;\n\t\tattribute lowp float textureIndex;\n\t\tattribute lowp float objectAlpha;\n\t\tuniform mat4 pMatrix;\n\t",T.REGULAR_FRAGMENT_HEADER="\n\t\t"+T.REGULAR_VARYING_HEADER+"\n\t\tuniform sampler2D uSampler[{{count}}];\n\t",T.REGULAR_VERTEX_BODY="\n\t\tvoid main (void) {\n\t\t\t// DHG TODO: This doesn't work. Must be something wrong with the hand built matrix see js... bypass for now\n\t\t\t// vertexPosition, round if flag\n\t\t\t// gl_Position = pMatrix * vec4(vertexPosition.x, vertexPosition.y, 0.0, 1.0);\n\t\t\tgl_Position = vec4(\n\t\t\t\t(vertexPosition.x * pMatrix[0][0]) + pMatrix[3][0],\n\t\t\t\t(vertexPosition.y * pMatrix[1][1]) + pMatrix[3][1],\n\t\t\t\tpMatrix[3][2],\n\t\t\t\t1.0\n\t\t\t);\n\t\t\talphaValue = objectAlpha;\n\t\t\tindexPicker = textureIndex;\n\t\t\tvTextureCoord = uvPosition;\n\t\t}\n\t",T.REGULAR_FRAGMENT_BODY="\n\t\tvoid main (void) {\n\t\t\tint src = int(indexPicker);\n\t\t\tvec4 color = vec4(1.0, 0.0, 0.0, 1.0);\n\n\t\t\tif (src == 0) {\n\t\t\t\tcolor = texture2D(uSampler[0], vTextureCoord);\n\t\t\t\t{{alternates}}\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4(color.rgb{{premultiply}}, color.a * alphaValue);\n\t\t}\n\t",T.PARTICLE_VERTEX_BODY="\n\t\t"+T.REGULAR_VERTEX_BODY+"\n\t",T.PARTICLE_FRAGMENT_BODY="\n\t\t"+T.REGULAR_FRAGMENT_BODY+"\n\t",T.COVER_VARYING_HEADER="\n\t\tprecision mediump float;\n\t\tvarying highp vec2 vRenderCoord;\n\t\tvarying highp vec2 vTextureCoord;\n\t",T.COVER_VERTEX_HEADER="\n\t\t"+T.COVER_VARYING_HEADER+"\n\t\tattribute vec2 vertexPosition;\n\t\tattribute vec2 uvPosition;\n\t\tuniform float uUpright;\n\t",T.COVER_FRAGMENT_HEADER="\n\t\t"+T.COVER_VARYING_HEADER+"\n\t\tuniform sampler2D uSampler;\n\t",T.COVER_VERTEX_BODY="\n\t\tvoid main (void) {\n\t\t\tgl_Position = vec4(vertexPosition.x, vertexPosition.y, 0.0, 1.0);\n\t\t\tvRenderCoord = uvPosition;\n\t\t\tvTextureCoord = vec2(uvPosition.x, abs(uUpright - uvPosition.y));\n\t\t}\n\t",T.COVER_FRAGMENT_BODY="\n\t\tvoid main (void) {\n\t\t\tvec4 color = texture2D(uSampler, vRenderCoord);\n\t\t\tgl_FragColor = color;\n\t\t}\n\t";var E=function(t){function i(r){e(this,i);var n=s(this,t.call(this));return"string"==typeof r?(n.image=document.createElement("img"),n.image.src=r):n.image=r,n.sourceRect=null,n._webGLRenderStyle=2,n}return n(i,t),i.prototype.isVisible=function(){var t=this.image,e=this.cacheCanvas||t&&(t.naturalWidth||t.getContext||t.readyState>=2);return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&e)},i.prototype.draw=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.prototype.draw.call(this,e,i)||!this.image)return!0;var r=this.image,n=this.sourceRect;if(n){var s=n.x,o=n.y,a=s+n.width,h=o+n.height,u=0,l=0,c=r.width,p=r.height;s<0&&(u-=s,s=0),a>c&&(a=c),o<0&&(l-=o,o=0),h>p&&(h=p),e.drawImage(r,s,o,a-s,h-o,u,l,a-s,h-o)}else e.drawImage(r,0,0);return!0},i.prototype.getBounds=function(){var e=t.prototype.getBounds.call(this);if(e)return e;var i=this.image,r=this.sourceRect||i,n=i&&(i.naturalWidth||i.getContext||i.readyState>=2);return n?this._rectangle.setValues(0,0,r.width,r.height):null},i.prototype.clone=function(){var t=new i(this.image);return this.sourceRect&&(t.sourceRect=this.sourceRect.clone()),this._cloneProps(t),t},i}(m),R=function(t){function i(r,n){e(this,i);var o=s(this,t.call(this));return o.currentFrame=0,o.currentAnimation=null,o.paused=!0,o.spriteSheet=r,o.currentAnimationFrame=0,o.framerate=0,o._animation=null,o._currentFrame=null,o._skipAdvance=!1,o._webGLRenderStyle=1,null!=n&&o.gotoAndPlay(n),o}return n(i,t),i.prototype.isVisible=function(){var t=this.cacheCanvas||this.spriteSheet.complete;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},i.prototype.draw=function(e,i){if(t.prototype.draw.call(this,e,i))return!0;this._normalizeFrame();var r=this.spriteSheet.getFrame(0|this._currentFrame);if(!r)return!1;var n=r.rect;return n.width&&n.height&&e.drawImage(r.image,n.x,n.y,n.width,n.height,-r.regX,-r.regY,n.width,n.height),!0},i.prototype.play=function(){this.paused=!1},i.prototype.stop=function(){this.paused=!0},i.prototype.gotoAndPlay=function(t){this.paused=!1,this._skipAdvance=!0,this._goto(t)},i.prototype.gotoAndStop=function(t){this.paused=!0,this._goto(t)},i.prototype.advance=function(t){var e=this.framerate||this.spriteSheet.framerate,i=e&&null!=t?t/(1e3/e):1;this._normalizeFrame(i)},i.prototype.getBounds=function(){return t.prototype.getBounds.call(this)||this.spriteSheet.getFrameBounds(this.currentFrame,this._rectangle)},i.prototype.clone=function(){return this._cloneProps(new i(this.spriteSheet))},i.prototype._cloneProps=function(e){return t.prototype._cloneProps.call(this,e),e.currentFrame=this.currentFrame,e.currentAnimation=this.currentAnimation,e.paused=this.paused,e.currentAnimationFrame=this.currentAnimationFrame,e.framerate=this.framerate,e._animation=this._animation,e._currentFrame=this._currentFrame,e._skipAdvance=this._skipAdvance,e},i.prototype._tick=function(e){this.paused||(this._skipAdvance||this.advance(e&&e.delta),this._skipAdvance=!1),t.prototype._tick.call(this,e)},i.prototype._normalizeFrame=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this._animation,i=this.paused,r=this._currentFrame;if(e){var n=e.speed||1,s=this.currentAnimationFrame,o=e.frames.length;if(s+t*n>=o){var a=e.next;if(this._dispatchAnimationEnd(e,r,i,a,o-1))return;if(a)return this._goto(a,t-(o-s)/n);this.paused=!0,s=e.frames.length-1}else s+=t*n;this.currentAnimationFrame=s,this._currentFrame=e.frames[0|s]}else{r=this._currentFrame+=t;var h=this.spriteSheet.getNumFrames();if(r>=h&&h>0&&!this._dispatchAnimationEnd(e,r,i,h-1)&&(this._currentFrame-=h)>=h)return this._normalizeFrame()}r=0|this._currentFrame,this.currentFrame!=r&&(this.currentFrame=r,this.dispatchEvent("change"))},i.prototype._dispatchAnimationEnd=function(t,e,i,r,n){var s=t?t.name:null;if(this.hasEventListener("animationend")){var a=new o("animationend");a.name=s,a.next=r,this.dispatchEvent(a)}var h=this._animation!=t||this._currentFrame!=e;return h||i||!this.paused||(this.currentAnimationFrame=n,h=!0),h},i.prototype._goto=function(t,e){if(this.currentAnimationFrame=0,isNaN(t)){var i=this.spriteSheet.getAnimation(t);i&&(this._animation=i,this.currentAnimation=t,this._normalizeFrame(e))}else this.currentAnimation=this._animation=null,this._currentFrame=t,this._normalizeFrame()},i}(m),A=100,C=[],D=function(t){function i(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e(this,i);var o=s(this,t.call(this));return o.text=r,o.spriteSheet=n,o.lineHeight=0,o.letterSpacing=0,o.spaceWidth=0,o._oldProps={text:0,spriteSheet:0,lineHeight:0,letterSpacing:0,spaceWidth:0},o}return n(i,t),i.prototype.draw=function(e,i){t.prototype.draw.call(this,e,i)},i.prototype.getBounds=function(){return this._updateText(),t.prototype.getBounds.call(this)},i.prototype.isVisible=function(){var t=this.cacheCanvas||this.spriteSheet&&this.spriteSheet.complete&&this.text;return!!(this.visible&&this.alpha>0&&0!==this.scaleX&&0!==this.scaleY&&t)},i.prototype.clone=function(){return this._cloneProps(new i(this.text,this.spriteSheet))},i.prototype.addChild=function(){},i.prototype.addChildAt=function(){},i.prototype.removeChild=function(){},i.prototype.removeChildAt=function(){},i.prototype.removeAllChildren=function(){},i.prototype._cloneProps=function(e){return t.prototype._cloneProps.call(this,e),e.lineHeight=this.lineHeight,e.letterSpacing=this.letterSpacing,e.spaceWidth=this.spaceWidth,e},i.prototype._getFrameIndex=function(t,e){var i=void 0,r=e.getAnimation(t);return r||(t!=(i=t.toUpperCase())||t!=(i=t.toLowerCase())||(i=null),i&&(r=e.getAnimation(i))),r&&r.frames[0]},i.prototype._getFrame=function(t,e){var i=this._getFrameIndex(t,e);return null==i?i:e.getFrame(i)},i.prototype._getLineHeight=function(t){var e=this._getFrame("1",t)||this._getFrame("T",t)||this._getFrame("L",t)||t.getFrame(0);return e?e.rect.height:1},i.prototype._getSpaceWidth=function(t){var e=this._getFrame("1",t)||this._getFrame("l",t)||this._getFrame("e",t)||this._getFrame("a",t)||t.getFrame(0);return e?e.rect.width:1},i.prototype._tick=function(e){var i=this.stage;i&&i.on("drawstart",this._updateText,this,!0),t.prototype._tick.call(this,e)},i.prototype._updateText=function(){var t=0,e=0,r=this._oldProps,n=!1,s=this.spaceWidth,o=this.lineHeight,a=this.spriteSheet,h=i._spritePool,u=this.children,l=0,c=u.length,p=void 0;for(var d in r)r[d]!=this[d]&&(r[d]=this[d],n=!0);if(n){var _=!!this._getFrame(" ",a);_||s||(s=this._getSpaceWidth(a)),o||(o=this._getLineHeight(a));for(var f=0,v=this.text.length;f<v;f++){var g=this.text.charAt(f);if(" "!=g||_)if("\n"!=g&&"\r"!=g){var m=this._getFrameIndex(g,a);null!=m&&(l<c?p=u[l]:(u.push(p=h.length?h.pop():new R),p.parent=this,c++),p.spriteSheet=a,p.gotoAndStop(m),p.x=t,p.y=e,l++,t+=p.getBounds().width+this.letterSpacing)}else"\r"==g&&"\n"==this.text.charAt(f+1)&&f++,t=0,e+=o;else t+=s}for(;c>l;)h.push(p=u.pop()),p.parent=null,c--;h.length>i.maxPoolSize&&(h.length=i.maxPoolSize)}},r(i,null,[{key:"maxPoolSize",get:function(){return A},set:function(t){A=t}},{key:"_spritePool",get:function(){return C}}]),i}(x),S=function(t){function i(r){e(this,i);var n=s(this,t.call(this));"string"==typeof r&&(r=document.getElementById(r)),n.mouseEnabled=!1;var o=r.style;return o.position="absolute",o.transformOrigin=o.WebkitTransformOrigin=o.msTransformOrigin=o.MozTransformOrigin=o.OTransformOrigin="0% 0%",n.htmlElement=r,n._oldProps=null,n}return n(i,t),i.prototype.isVisible=function(){return null!=this.htmlElement},i.prototype.draw=function(t,e){return!0},i.prototype.cache=function(){},i.prototype.uncache=function(){},i.prototype.updateCache=function(){},i.prototype.hitTest=function(){},i.prototype.localToGlobal=function(){},i.prototype.globalToLocal=function(){},i.prototype.localToLocal=function(){},i.prototype.clone=function(){throw"DOMElement cannot be cloned."},i.prototype._tick=function(e){var i=this.stage;i&&i.on("drawend",this._handleDrawEnd,this,!0),t.prototype._tick.call(this,e)},i.prototype._handleDrawEnd=function(t){var e=this.htmlElement;if(e){var i=e.style,r=this.getConcatenatedDisplayProps(this._props),n=r.matrix,s=r.visible?"visible":"hidden";if(s!=i.visibility&&(i.visibility=s),r.visible){var o=this._oldProps,a=o&&o.matrix,h=1e4;if(!a||!a.equals(n)){var u="matrix("+(n.a*h|0)/h+","+(n.b*h|0)/h+","+(n.c*h|0)/h+","+(n.d*h|0)/h+","+(n.tx+.5|0);i.transform=i.WebkitTransform=i.OTransform=i.msTransform=u+","+(n.ty+.5|0)+")",i.MozTransform=u+"px,"+(n.ty+.5|0)+"px)",o||(o=this._oldProps=new _((!0),NaN)),o.matrix.copy(n)}o.alpha!=r.alpha&&(i.opacity=""+(r.alpha*h|0)/h,o.alpha=r.alpha)}}},i}(m),I=function(){function t(){e(this,t),this.command=null,this._stroke=null,this._strokeStyle=null,this._oldStrokeStyle=null,this._strokeDash=null,this._oldStrokeDash=null,this._strokeIgnoreScale=!1,this._fill=null,this._instructions=[],this._commitIndex=0,this._activeInstructions=[],this._dirty=!1,this._storeIndex=0,this.curveTo=this.quadraticCurveTo,this.drawRect=this.rect,this.mt=this.moveTo,this.lt=this.lineTo,this.at=this.arcTo,this.bt=this.bezierCurveTo,this.qt=this.quadraticCurveTo,this.a=this.arc,this.r=this.rect,this.cp=this.closePath,this.c=this.clear,this.f=this.beginFill,this.lf=this.beginLinearGradientFill,this.rf=this.beginRadialGradientFill,this.bf=this.beginBitmapFill,this.ef=this.endFill,this.ss=this.setStrokeStyle,this.sd=this.setStrokeDash,this.s=this.beginStroke,this.ls=this.beginLinearGradientStroke,this.rs=this.beginRadialGradientStroke,this.bs=this.beginBitmapStroke,this.es=this.endStroke,this.dr=this.drawRect,this.rr=this.drawRoundRect,this.rc=this.drawRoundRectComplex,this.dc=this.drawCircle,this.de=this.drawEllipse,this.dp=this.drawPolyStar,this.p=this.decodePath,this.clear()}return t.getRGB=function(t,e,i,r){return null!=t&&null==i&&(r=e,i=255&t,e=t>>8&255,t=t>>16&255),null==r?"rgb("+t+","+e+","+i+")":"rgba("+t+","+e+","+i+","+r+")"},t.getHSL=function(t,e,i,r){return null==r?"hsl("+t%360+","+e+"%,"+i+"%)":"hsl("+t%360+","+e+"%,"+i+"%,"+r+")"},t.prototype.isEmpty=function(){return!(this._instructions.length||this._activeInstructions.length)},t.prototype.draw=function(t,e){this._updateInstructions();for(var i=this._instructions,r=i.length,n=this._storeIndex;n<r;n++)i[n].exec(t,e)},t.prototype.drawAsPath=function(t){this._updateInstructions();for(var e=void 0,i=this._instructions,r=i.length,n=this._storeIndex;n<r;n++)(e=i[n]).path!==!1&&e.exec(t)},t.prototype.moveTo=function(t,e){return this.append(new M(t,e),!0)},t.prototype.lineTo=function(t,e){return this.append(new P(t,e))},t.prototype.arcTo=function(t,e,i,r,n){return this.append(new L(t,e,i,r,n))},t.prototype.arc=function(t,e,i,r,n,s){return this.append(new k(t,e,i,r,n,s))},t.prototype.quadraticCurveTo=function(t,e,i,r){return this.append(new F(t,e,i,r))},t.prototype.bezierCurveTo=function(t,e,i,r,n,s){return this.append(new O(t,e,i,r,n,s))},t.prototype.rect=function(t,e,i,r){return this.append(new B(t,e,i,r))},t.prototype.closePath=function(){return this._activeInstructions.length?this.append(new G):this},t.prototype.clear=function(){return this._instructions.length=this._activeInstructions.length=this._commitIndex=0,this._strokeStyle=this._oldStrokeStyle=this._stroke=this._fill=this._strokeDash=this._oldStrokeDash=null,this._dirty=this._strokeIgnoreScale=!1,this},t.prototype.beginFill=function(t){return this._setFill(t?new N(t):null)},t.prototype.beginLinearGradientFill=function(t,e,i,r,n,s){return this._setFill((new N).linearGradient(t,e,i,r,n,s))},t.prototype.beginRadialGradientFill=function(t,e,i,r,n,s,o,a){return this._setFill((new N).radialGradient(t,e,i,r,n,s,o,a))},t.prototype.beginBitmapFill=function(t,e,i){return this._setFill(new N(null,i).bitmap(t,e))},t.prototype.endFill=function(){return this.beginFill()},t.prototype.setStrokeStyle=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this._updateInstructions(!0),this._strokeStyle=this.command=new Y(t,e,i,r,n),this._stroke&&(this._stroke.ignoreScale=n),this._strokeIgnoreScale=n,this},t.prototype.setStrokeDash=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._updateInstructions(!0),this._strokeDash=this.command=new H(t,e),this},t.prototype.beginStroke=function(t){return this._setStroke(t?new X(t):null)},t.prototype.beginLinearGradientStroke=function(t,e,i,r,n,s){return this._setStroke((new X).linearGradient(t,e,i,r,n,s))},t.prototype.beginRadialGradientStroke=function(t,e,i,r,n,s,o,a){return this._setStroke((new X).radialGradient(t,e,i,r,n,s,o,a))},t.prototype.beginBitmapStroke=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"repeat";return this._setStroke((new X).bitmap(t,e))},t.prototype.endStroke=function(){return this.beginStroke()},t.prototype.drawRoundRect=function(t,e,i,r,n){return this.drawRoundRectComplex(t,e,i,r,n,n,n,n)},t.prototype.drawRoundRectComplex=function(t,e,i,r,n,s,o,a){return this.append(new V(t,e,i,r,n,s,o,a))},t.prototype.drawCircle=function(t,e,i){return this.append(new W(t,e,i))},t.prototype.drawEllipse=function(t,e,i,r){return this.append(new j(t,e,i,r))},t.prototype.drawPolyStar=function(t,e,i,r,n,s){return this.append(new z(t,e,i,r,n,s))},t.prototype.append=function(t,e){return this._activeInstructions.push(t),this.command=t,e||(this._dirty=!0),this},t.prototype.decodePath=function(e){for(var i=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],r=[2,2,4,6,0],n=0,s=e.length,o=[],a=0,h=0,u=t.BASE_64;n<s;){var l=e.charAt(n),c=u[l],p=c>>3,d=i[p];if(!d||3&c)throw"bad path data (@"+n+"):c";var _=r[p];p||(a=h=0),o.length=0,n++;for(var f=(c>>2&1)+2,v=0;v<_;v++){var g=u[e.charAt(n)],m=g>>5?-1:1;g=(31&g)<<6|u[e.charAt(n+1)],3==f&&(g=g<<6|u[e.charAt(n+2)]),g=m*g/10,v%2?a=g+=a:h=g+=h,o[v]=g,n+=f}d.apply(this,o)}return this},t.prototype.store=function(){return this._updateInstructions(!0),this._storeIndex=this._instructions.length,this},t.prototype.unstore=function(){return this._storeIndex=0,this},t.prototype.clone=function(){var e=new t;return e.command=this.command,e._stroke=this._stroke,e._strokeStyle=this._strokeStyle,e._strokeDash=this._strokeDash,e._strokeIgnoreScale=this._strokeIgnoreScale,e._fill=this._fill,e._instructions=this._instructions.slice(),e._commitIndex=this._commitIndex,e._activeInstructions=this._activeInstructions.slice(),e._dirty=this._dirty,e._storeIndex=this._storeIndex,e},t.prototype.toString=function(){return"["+this.constructor.name+"]"},t.prototype._updateInstructions=function(e){var i=this._instructions,r=this._activeInstructions,n=this._commitIndex;if(this._dirty&&r.length){i.length=n,i.push(t.beginCmd);var s=r.length,o=i.length;i.length=o+s;for(var a=0;a<s;a++)i[a+o]=r[a];this._fill&&i.push(this._fill),this._stroke&&(this._strokeDash!==this._oldStrokeDash&&(this._oldStrokeDash=this._strokeDash,i.push(this._strokeDash)),this._strokeStyle!==this._oldStrokeStyle&&(this._oldStrokeStyle=this._strokeStyle,i.push(this._strokeStyle)),i.push(this._stroke)),this._dirty=!1}e&&(r.length=0,this._commitIndex=i.length)},t.prototype._setFill=function(t){return this._updateInstructions(!0),this.command=this._fill=t,this},t.prototype._setStroke=function(t){return this._updateInstructions(!0),(this.command=this._stroke=t)&&(t.ignoreScale=this._strokeIgnoreScale),this},r(t,[{key:"instructions",get:function(){return this._updateInstructions(),this._instructions}}]),t}(),P=function(){function t(i,r){e(this,t),this.x=i,this.y=r}return t.prototype.exec=function(t){t.lineTo(this.x,this.y)},t}(),M=function(){function t(i,r){e(this,t),this.x=i,this.y=r}return t.prototype.exec=function(t){t.moveTo(this.x,this.y)},t}(),L=function(){function t(i,r,n,s,o){e(this,t),this.x1=i,this.y1=r,this.x2=n,this.y2=s,this.radius=o}return t.prototype.exec=function(t){t.arcTo(this.x1,this.y1,this.x2,this.y2,this.radius)},t}(),k=function(){function t(i,r,n,s,o,a){e(this,t),this.x=i,this.y=r,this.radius=n,this.startAngle=s,this.endAngle=o,this.anticlockwise=!!a}return t.prototype.exec=function(t){t.arc(this.x,this.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)},t}(),F=function(){function t(i,r,n,s){e(this,t),this.cpx=i,this.cpy=r,this.x=n,this.y=s}return t.prototype.exec=function(t){t.quadraticCurveTo(this.cpx,this.cpy,this.x,this.y)},t}(),O=function(){function t(i,r,n,s,o,a){e(this,t),this.cp1x=i,this.cp1y=r,this.cp2x=n,this.cp2y=s,this.x=o,this.y=a}return t.prototype.exec=function(t){t.bezierCurveTo(this.cp1x,this.cp1y,this.cp2x,this.cp2y,this.x,this.y)},t}(),B=function(){function t(i,r,n,s){e(this,t),this.x=i,this.y=r,this.w=n,this.h=s}return t.prototype.exec=function(t){t.rect(this.x,this.y,this.w,this.h)},t}(),G=function(){function t(){e(this,t)}return t.prototype.exec=function(t){t.closePath()},t}(),U=function(){function t(){e(this,t)}return t.prototype.exec=function(t){t.beginPath()},t}(),N=function(){function t(i,r){e(this,t),this.style=i,this.matrix=r,this.path=!1}return t.prototype.exec=function(t){if(this.style){t.fillStyle=this.style;var e=this.matrix;e&&(t.save(),t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)),t.fill(),e&&t.restore()}},t.prototype.linearGradient=function(t,e,i,r,n,s){for(var o=this.style=I._ctx.createLinearGradient(i,r,n,s),a=t.length,h=0;h<a;h++)o.addColorStop(e[h],t[h]);return o.props={colors:t,ratios:e,x0:i,y0:r,x1:n,y1:s,type:"linear"},this},t.prototype.radialGradient=function(t,e,i,r,n,s,o,a){for(var h=this.style=I._ctx.createRadialGradient(i,r,n,s,o,a),u=t.length,l=0;l<u;l++)h.addColorStop(e[l],t[l]);return h.props={colors:t,ratios:e,x0:i,y0:r,r0:n,x1:s,y1:o,r1:a,type:"radial"},this},t.prototype.bitmap=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t.naturalWidth||t.getContext||t.readyState>=2){var i=this.style=I._ctx.createPattern(t,e);i.props={image:t,repetition:e,type:"bitmap"}}return this},t}(),X=function(){function t(i,r){e(this,t),this.style=i,this.ignoreScale=r,this.path=!1}return t.prototype.exec=function(t){this.style&&(t.strokeStyle=this.style,this.ignoreScale&&(t.save(),t.setTransform(1,0,0,1,0,0)),t.stroke(),this.ignoreScale&&t.restore())},t.prototype.linearGradient=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];N.prototype.linearGradient.apply(this,e)},t.prototype.radialGradient=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];N.prototype.radialGradient.apply(this,e)},t.prototype.bitmap=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];N.prototype.bitmap.apply(this,e)},t}(),Y=function(){function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"butt",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"miter",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];e(this,t),this.width=i,this.caps=r,this.joints=n,this.miterLimit=s,this.ignoreScale=o,this.path=!1}return t.prototype.exec=function(t){t.lineWidth=this.width,t.lineCap=isNaN(this.caps)?this.caps:I.STROKE_CAPS_MAP[this.caps],t.lineJoin=isNaN(this.joints)?this.joints:I.STROKE_JOINTS_MAP[this.joints],t.miterLimit=this.miterLimit,t.ignoreScale=this.ignoreScale},t}(),H=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.EMPTY_SEGMENTS,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.segments=i,this.offset=r}return t.prototype.exec=function(t){t.setLineDash&&(t.setLineDash(this.segments),t.lineDashOffset=this.offset)},r(t,null,[{key:"EMPTY_SEGMENTS",get:function(){return _EMPTY_SEGMENTS}}]),t}(),V=function(){function t(i,r,n,s,o,a,h,u){e(this,t),this.x=i,this.y=r,this.w=n,this.h=s,this.radiusTL=o,this.radiusTR=a,this.radiusBR=h,this.radiusBL=u}return t.prototype.exec=function(t){var e=(h<u?h:u)/2,i=0,r=0,n=0,s=0,o=this.x,a=this.y,h=this.w,u=this.h,l=this.radiusTL,c=this.radiusTR,p=this.radiusBR,d=this.radiusBL;l<0&&(l*=i=-1),l>e&&(l=e),c<0&&(c*=r=-1),c>e&&(c=e),p<0&&(p*=n=-1),p>e&&(p=e),d<0&&(d*=s=-1),d>e&&(d=e),t.moveTo(o+h-c,a),t.arcTo(o+h+c*r,a-c*r,o+h,a+c,c),t.lineTo(o+h,a+u-p),t.arcTo(o+h+p*n,a+u+p*n,o+h-p,a+u,p),t.lineTo(o+d,a+u),t.arcTo(o-d*s,a+u+d*s,o,a+u-d,d),t.lineTo(o,a+l),t.arcTo(o-l*i,a-l*i,o+l,a,l),t.closePath()},t}(),W=function(){function t(i,r,n){e(this,t),this.x=i,this.y=r,this.radius=n}return t.prototype.exec=function(t){t.arc(this.x,this.y,this.radius,0,2*Math.PI)},t}(),j=function(){function t(i,r,n,s){e(this,t),this.x=i,this.y=r,this.w=n,this.h=s}return t.prototype.exec=function(t){var e=this.x,i=this.y,r=this.w,n=this.h,s=.5522848,o=r/2*s,a=n/2*s,h=e+r,u=i+n,l=e+r/2,c=i+n/2;t.moveTo(e,c),t.bezierCurveTo(e,c-a,l-o,i,l,i),t.bezierCurveTo(l+o,i,h,c-a,h,c),t.bezierCurveTo(h,c+a,l+o,u,l,u),t.bezierCurveTo(l-o,u,e,c+a,e,c)},t}(),z=function(){function t(i,r,n,s){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;e(this,t),this.x=i,this.y=r,this.radius=n,this.sides=s,this.pointSize=o,this.angle=a}return t.prototype.exec=function(t){var e=this.x,i=this.y,r=this.radius,n=this.angle/180*Math.PI,s=this.sides,o=1-this.pointSize,a=Math.PI/s;t.moveTo(e+Math.cos(n)*r,i+Math.sin(n)*r);for(var h=0;h<s;h++)n+=a,1!=o&&t.lineTo(e+Math.cos(n)*r*o,i+Math.sin(n)*r*o),n+=a,t.lineTo(e+Math.cos(n)*r,i+Math.sin(n)*r);t.closePath()},t}(),q=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");q.getContext&&(I._ctx=q.getContext("2d"),q.width=q.height=1),I.beginCmd=new U,I.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},I.STROKE_CAPS_MAP=["butt","round","square"],I.STROKE_JOINTS_MAP=["miter","round","bevel"],I.EMPTY_SEGMENTS=[];var Z=function(){function t(i){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e(this,t),this.type=i,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=r,this.cancelable=n,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}return t.prototype.preventDefault=function(){this.defaultPrevented=this.cancelable},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t.prototype.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},t.prototype.remove=function(){this.removed=!0},t.prototype.clone=function(){var e=new t(this.type,this.bubbles,this.cancelable);for(var i in this)this.hasOwnProperty(i)&&(e[i]=this[i]);return e},t.prototype.set=function(t){for(var e in t)this[e]=t[e];return this},t.prototype.toString=function(){return"["+this.constructor.name+" (type="+this.type+")]"},t}(),K=function(){function t(){e(this,t),this._listeners=null,this._captureListeners=null}return t.initialize=function(e){var i=t.prototype;e.addEventListener=i.addEventListener,e.on=i.on,e.removeEventListener=e.off=i.removeEventListener,e.removeAllEventListeners=i.removeAllEventListeners,e.hasEventListener=i.hasEventListener,e.dispatchEvent=i.dispatchEvent,e._dispatchEvent=i._dispatchEvent,e.willTrigger=i.willTrigger},t.prototype.addEventListener=function(t,e,i){var r=void 0;r=i?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var n=r[t];return n&&this.removeEventListener(t,e,i),n=r[t],n?n.push(e):r[t]=[e],e},t.prototype.on=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return e.handleEvent&&(i=i||e,e=e.handleEvent),i=i||this,this.addEventListener(t,function(t){e.call(i,t,n),r&&t.remove()},s)},t.prototype.removeEventListener=function(t,e,i){var r=i?this._captureListeners:this._listeners;if(r){var n=r[t];if(n)for(var s=n.length,o=0;o<s;o++)if(n[o]==e){1==s?delete r[t]:n.splice(o,1);break}}},t.prototype.off=function(t,e,i){this.removeEventListener(t,e,i)},t.prototype.removeAllEventListeners=function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},t.prototype.dispatchEvent=function(t){
var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"==typeof t){var r=this._listeners;if(!(e||r&&r[t]))return!0;t=new Z(t,e,i)}else t.target&&t.clone&&(t=t.clone());try{t.target=this}catch(t){}if(t.bubbles&&this.parent){for(var n=this,s=void 0,o=[n];n.parent;)o.push(n=n.parent);var a=o.length;for(s=a-1;s>=0&&!t.propagationStopped;s--)o[s]._dispatchEvent(t,1+(0==s));for(s=1;s<a&&!t.propagationStopped;s++)o[s]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return!t.defaultPrevented},t.prototype.hasEventListener=function(t){var e=this._listeners,i=this._captureListeners;return!!(e&&e[t]||i&&i[t])},t.prototype.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.parent}return!1},t.prototype.toString=function(){return"[EventDispatcher]"},t.prototype._dispatchEvent=function(t,e){var i=1==e?this._captureListeners:this._listeners,r=void 0;if(t&&i){var n=i[t.type];if(!n||!(r=n.length))return;try{t.currentTarget=this}catch(t){}try{t.eventPhase=e}catch(t){}t.removed=!1,n=n.slice();for(var s=0;s<r&&!t.immediatePropagationStopped;s++){var o=n[s];o.handleEvent?o.handleEvent(t):o(t),t.removed&&(this.off(t.type,o,1==e),t.removed=!1)}}},t}(),J=function(t){function o(i){e(this,o);var r=s(this,t.call(this));return r.ignoreGlobalPause=!1,r.loop=0,r.useTicks=!1,r.reversed=!1,r.bounce=!1,r.timeScale=1,r.duration=0,r.position=0,r.rawPosition=-1,r._paused=!0,r._next=null,r._prev=null,r._parent=null,r._labels=null,r._labelList=null,i&&(r.useTicks=!!i.useTicks,r.ignoreGlobalPause=!!i.ignoreGlobalPause,r.loop=i.loop===!0?-1:i.loop||0,r.reversed=!!i.reversed,r.bounce=!!i.bounce,r.timeScale=i.timeScale||1,i.onChange&&r.addEventListener("change",i.onChange),i.onComplete&&r.addEventListener("complete",i.onComplete)),r}return n(o,t),o.prototype.advance=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setPosition(this.rawPosition+t*this.timeScale,e)},o.prototype.setPosition=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments[3],n=this.duration,s=this.loop,o=this.rawPosition,a=0,h=0,u=!1;if(t<0&&(t=0),0===n){if(u=!0,o!==-1)return u}else{if(a=t/n|0,h=t-a*n,u=s!==-1&&t>=s*n+n,u&&(t=(h=n)*(a=s)+n),t===o)return u;var l=!this.reversed!=!(this.bounce&&a%2);l&&(h=n-h)}this.position=h,this.rawPosition=t,this._updatePosition(i,u),u&&this.setPaused(!0),r&&r(this),e||this._runActions(o,t,i,!i&&o===-1),this.dispatchEvent("change"),u&&this.dispatchEvent("complete")},o.prototype.calculatePosition=function(t){var e=this.duration,i=this.loop,r=0,n=0;if(0===e)return 0;i!==-1&&t>=i*e+e?(n=e,r=i):t<0?n=0:(r=t/e|0,n=t-r*e);var s=!this.reversed!=!(this.bounce&&r%2);return s?e-n:n},o.prototype.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[t]=e;var r=this._labelList;if(r){for(var n=0,s=r.length;n<s&&!(e<r[n].position);n++);r.splice(i,0,{label:t,position:e})}},o.prototype.getCurrentLabel=function(t){var e=this.labels;null==t&&(t=this.position);for(var r=0,n=e.length;r<n&&!(t<e[r].position);r++);return 0===i?null:e[i-1].label},o.prototype.gotoAndPlay=function(t){this.setPaused(!1),this._goto(t)},o.prototype.gotoAndStop=function(t){this.setPaused(!0),this._goto(t)},o.prototype.resolve=function(t){var e=Number(t);return isNaN(e)&&(e=this._labels&&this._labels[t]),e},o.prototype.setPaused=function(t){return et._register(this,t),this},o.prototype.toString=function(){return"["+this.constructor.name+(this.name?" (name="+this.name+")":"")+"]"},o.prototype.clone=function(){throw"AbstractTween can not be cloned."},o.prototype._init=function(t){t&&t.paused||this.setPaused(!1),t&&null!=t.position&&this.setPosition(t.position)},o.prototype._goto=function(t){var e=this.resolve(t);null!=e&&this.setPosition(e,!1,!0)},o.prototype._runActions=function(t,e,i,r){if(this._actionHead||this._tweens){var n=this.duration,s=this.reversed,o=this.bounce,a=this.loop,h=void 0,u=void 0,l=void 0,c=void 0;if(0===n?(h=u=l=c=0,s=o=!1):(h=t/n|0,u=e/n|0,l=t-h*n,c=e-u*n),a!==-1&&(u>a&&(c=n,u=a),h>a&&(l=n,h=a)),i)return this._runActionsRange(c,c,i,r);if(h!==u||l!==c||i){h===-1&&(h=l=0);var p=t<=e,d=h;do{var _=!s!=!(o&&d%2),f=d===h?l:p?0:n,v=d===u?c:p?n:0;if(_&&(f=n-f,v=n-v),o&&d!==h&&f===v);else if(this._runActionsRange(f,v,i,r||d!==h&&!o))return!0;r=!1}while(p&&++d<=u||!p&&--d>=u)}}},o.prototype._runActionsRange=function(t,e,i,r){},o.prototype._updatePosition=function(t,e){},r(o,[{key:"labels",get:function(){var t=this._labelList;if(!t){t=this._labelList=[];var e=this._labels;for(var i in e)t.push({label:i,position:e[i]});t.sort(function(t,e){return t.position-e.position})}return t},set:function(t){this._labels=t,this._labelList=null}}]),o}(K),Q=function(){function t(){throw e(this,t),"Ease is static and cannot be instantiated."}return t.linear=function(t){return t},t.get=function(t){return t<-1?t=-1:t>1&&(t=1),function(e){return 0==t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}},t.getPowIn=function(t){return function(e){return Math.pow(e,t)}},t.getPowOut=function(t){return function(e){return 1-Math.pow(1-e,t)}},t.getPowInOut=function(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}},t.sineIn=function(t){return 1-Math.cos(t*Math.PI/2)},t.sineOut=function(t){return Math.sin(t*Math.PI/2)},t.sineInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},t.getBackIn=function(t){return function(e){return e*e*((t+1)*e-t)}},t.getBackOut=function(t){return function(e){return--e*e*((t+1)*e+t)+1}},t.getBackInOut=function(t){return t*=1.525,function(e){return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}},t.circIn=function(t){return-(Math.sqrt(1-t*t)-1)},t.circOut=function(t){return Math.sqrt(1- --t*t)},t.circInOut=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},t.bounceIn=function(e){return 1-t.bounceOut(1-e)},t.bounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},t.bounceInOut=function(e){return e<.5?.5*t.bounceIn(2*e):.5*t.bounceOut(2*e-1)+.5},t.getElasticIn=function(t,e){var i=2*Math.PI;return function(r){if(0===r||1===r)return r;var n=e/i*Math.asin(1/t);return-(t*Math.pow(2,10*(r-=1))*Math.sin((r-n)*i/e))}},t.getElasticOut=function(t,e){var i=2*Math.PI;return function(r){if(0===r||1===r)return r;var n=e/i*Math.asin(1/t);return t*Math.pow(2,-10*r)*Math.sin((r-n)*i/e)+1}},t.getElasticInOut=function(t,e){var i=2*Math.PI;return function(r){var n=e/i*Math.asin(1/t);return(r*=2)<1?-.5*(t*Math.pow(2,10*(r-=1))*Math.sin((r-n)*i/e)):t*Math.pow(2,-10*(r-=1))*Math.sin((r-n)*i/e)*.5+1}},t}();Q.none=Q.linear,Q.quadIn=Q.getPowIn(2),Q.quadOut=Q.getPowOut(2),Q.quadInOut=Q.getPowInOut(2),Q.cubicIn=Q.getPowIn(3),Q.cubicOut=Q.getPowOut(3),Q.cubicInOut=Q.getPowInOut(3),Q.quartIn=Q.getPowIn(4),Q.quartOut=Q.getPowOut(4),Q.quartInOut=Q.getPowInOut(4),Q.quintIn=Q.getPowIn(5),Q.quintOut=Q.getPowOut(5),Q.quintInOut=Q.getPowInOut(5),Q.backIn=Q.getBackIn(1.7),Q.backOut=Q.getBackOut(1.7),Q.backInOut=Q.getBackInOut(1.7),Q.elasticIn=Q.getElasticIn(1,.3),Q.elasticOut=Q.getElasticOut(1,.3),Q.elasticInOut=Q.getElasticInOut(1,.3*1.5);var $=function(t){function i(r){e(this,i);var n=s(this,t.call(this));return n.name=r,n.timingMode=i.TIMEOUT,n.maxDelta=0,n.paused=!1,n._inited=!1,n._startTime=0,n._pausedTime=0,n._ticks=0,n._pausedTicks=0,n._interval=50,n._lastTime=0,n._times=null,n._tickTimes=null,n._timerId=null,n._raf=!0,n}return n(i,t),i.prototype.create=function(t){return new i(t)},i.prototype.init=function(){this._inited||(this._inited=!0,this._times=[],this._tickTimes=[],this._startTime=this._getTime(),this._times.push(this._lastTime=0),this._setupTick())},i.prototype.reset=function(){if(this._raf){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;t&&t(this._timerId)}else clearTimeout(this._timerId);this.removeAllEventListeners("tick"),this._timerId=this._times=this._tickTimes=null,this._startTime=this._lastTime=this._ticks=0,this._inited=!1},i.prototype.addEventListener=function(e,i,r){return!this._inited&&this.init(),t.prototype.addEventListener.call(this,e,i,r)},i.prototype.getMeasuredTickTime=function(t){var e=this._tickTimes;if(!e||e.length<1)return-1;t=Math.min(e.length,t||0|this.framerate);var i=e.reduce(function(t,e){return t+e},0);return i/t},i.prototype.getMeasuredFPS=function(t){var e=this._times;return!e||e.length<2?-1:(t=Math.min(e.length-1,t||0|this.framerate),1e3/((e[0]-e[t])/t))},i.prototype.getTime=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._startTime?this._getTime()-(t?this._pausedTime:0):-1},i.prototype.getEventTime=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._startTime?(this._lastTime||this._startTime)-(t?this._pausedTime:0):-1},i.prototype.getTicks=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._ticks-(t?this._pausedTicks:0)},i.prototype._handleSynch=function(){this._timerId=null,this._setupTick(),this._getTime()-this._lastTime>=.97*(this._interval-1)&&this._tick()},i.prototype._handleRAF=function(){this._timerId=null,this._setupTick(),this._tick()},i.prototype._handleTimeout=function(){this._timerId=null,this._setupTick(),this._tick()},i.prototype._setupTick=function(){if(null==this._timerId){var t=this.timingMode||this._raf&&i.RAF;if(t==i.RAF_SYNCHED||t==i.RAF){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(e)return this._timerId=e(t==i.RAF?this._handleRAF.bind(this):this._handleSynch.bind(this)),void(this._raf=!0)}this._raf=!1,this._timerId=setTimeout(this._handleTimeout.bind(this),this._interval)}},i.prototype._tick=function(){var t=this.paused,e=this._getTime(),i=e-this._lastTime;if(this._lastTime=e,this._ticks++,t&&(this._pausedTicks++,this._pausedTime+=i),this.hasEventListener("tick")){var r=new Z("tick"),n=this.maxDelta;r.delta=n&&i>n?n:i,r.paused=t,r.time=e,r.runTime=e-this._pausedTime,this.dispatchEvent(r)}for(this._tickTimes.unshift(this._getTime()-e);this._tickTimes.length>100;)this._tickTimes.pop();for(this._times.unshift(e);this._times.length>100;)this._times.pop()},i.prototype._getTime=function(){var t=window.performance.now;return(t&&t.call(performance)||(new Date).getTime())-this._startTime},r(i,[{key:"interval",get:function(){return this._interval},set:function(t){this._interval=t,this._inited&&this._setupTick()}},{key:"framerate",get:function(){return 1e3/this._interval},set:function(t){this.interval=1e3/t}}]),i}(K);$.RAF_SYNCHED="synched",$.RAF="raf",$.TIMEOUT="timeout";var tt=new $("createjs.global"),et=function(t){function r(i,n){e(this,r);var o=s(this,t.call(this,n));return o.pluginData=null,o.target=i,o.passive=!1,o._stepHead=new rt(null,0,0,{},null,(!0)),o._stepTail=o._stepHead,o._stepPosition=0,o._actionHead=null,o._actionTail=null,o._plugins=null,o._injected=null,n&&(o.pluginData=n.pluginData,n.override&&r.removeTweens(i)),o.pluginData||(o.pluginData={}),o._init(n),o}return n(r,t),r.get=function(t,e){return new r(t,e)},r.tick=function(t,e){for(var i=r._tweenHead;i;){var n=i._next;e&&!i.ignoreGlobalPause||i._paused||i.advance(i.useTicks?1:t),i=n}},r.handleEvent=function(t){"tick"===t.type&&this.tick(t.delta,t.paused)},r.removeTweens=function(t){if(t.tweenjs_count){for(var e=r._tweenHead;e;){var i=e._next;e.target===t&&r._register(e,!0),e=i}t.tweenjs_count=0}},r.removeAllTweens=function(){for(var t=r._tweenHead;t;){var e=t._next;t._paused=!0,t.target&&(t.target.tweenjs_count=0),t._next=t._prev=null,t=e}r._tweenHead=r._tweenTail=null},r.hasActiveTweens=function(t){return t?!!t.tweenjs_count:!!r._tweenHead},r._installPlugin=function(t){var e=t.priority,n=r._plugins;null==e&&(t.priority=e=0),n||(n=r._plugins=[]);for(var s=0,o=n.length;s<o&&!(e<n[s].priority);s++);n.splice(i,0,t)},r._register=function(t,e){var i=t.target;if(!e&&t._paused){i&&(i.tweenjs_count=i.tweenjs_count?i.tweenjs_count+1:1);var n=r._tweenTail;n?(r._tweenTail=n._next=t,t._prev=n):r._tweenHead=r._tweenTail=t,r._inited||(tt.addEventListener("tick",r),r._inited=!0)}else if(e&&!t._paused){i&&i.tweenjs_count--;var s=t._next,o=t._prev;s?s._prev=o:r._tweenTail=o,o?o._next=s:r._tweenHead=s,t._next=t._prev=null}t._paused=e},r.prototype.wait=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t>0&&this._addStep(t,this._stepTail.props,null,e),this},r.prototype.to=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.linear;e<0&&(e=0);var r=this._addStep(e,null,i);return this._appendProps(t,r),this},r.prototype.label=function(t){return this.addLabel(t,this.duration),this},r.prototype.call=function(t,e,i){return this._addAction(i||this.target,t,e||[this])},r.prototype.set=function(t,e){return this._addAction(e||this.target,this._set,[t])},r.prototype.play=function(t){return this.call(this.setPaused,[!1],t||this)},r.prototype.pause=function(t){return this.call(this.setPaused,[!0],t||this)},r.prototype.clone=function(){throw"Tween can not be cloned."},r.prototype._addPlugin=function(t){var e=this._plugins,i=t.priority,r=!1;e||(e=this._plugins=[]);for(var n=0,s=e.length;n<s;n++)if(e[n]===t){if(!r)return;e.splice(n,1)}else!r&&i<e[n].priority&&(e.splice(n,0,t),r=!0);r||e.push(t)},r.prototype._updatePosition=function(t,e){var i=this._stepHead.next,r=this.position,n=this.duration;if(this.target&&i){for(var s=i.next;s&&s.t<=r;)i=i.next,s=i.next;var o=e?r/n:(r-i.t)/i.d;this._updateTargetProps(i,o,e)}this._stepPosition=i?r-i.t:0},r.prototype._updateTargetProps=function(t,e,i){if(!(this.passive=!!t.passive)){var n=void 0,s=void 0,o=void 0,a=void 0,h=t.prev.props,u=t.props;(a=t.ease)&&(e=a(e,0,1,1));var l=this._plugins;for(var c in h){if(n=s=h[c],o=u[c],s!==o&&"number"==typeof s&&(n=s+(o-s)*e),l)for(var p=0,d=l.length;p<d;p++){var _=l[p].tween(this,t,c,n,e,i);if(n===r.IGNORE)return;void 0!==_&&(n=_)}this.target[c]=n}}},r.prototype._runActionsRange=function(t,e,i,r){var n=t>e,s=n?this._actionTail:this._actionHead,o=e,a=t;n&&(o=t,a=e);for(var h=this.position;s;){var u=s.t;if((u===e||u>a&&u<o||r&&u===t)&&(s.funct.apply(s.scope,s.params),h!==this.position))return!0;s=n?s.prev:s.next}},r.prototype._appendProps=function(t,e){var i=this._stepHead.props,n=this.target,s=r._plugins,o=void 0,a=void 0,h=e.prev,u=h.props,l=e.props=this._cloneProps(u);for(var c in t)if(l[c]=t[c],void 0===i[c]){var p=void 0;if(s)for(var d=0,_=s.length;d<_;d++){var f=s[d].init(this,c,p);if(void 0!==f&&(p=f),p===r.IGNORE){(a=a||{})[c]=!0,delete l[c];break}}p!==r.IGNORE&&(void 0===p&&(p=n[c]),u[c]=void 0===p?null:p)}s=this._plugins;for(var v in t)if(!a||!a[v]){for(var g=(t[v],void 0),m=h;(g=m)&&(m=g.prev);)if(m.props!==g.props){if(void 0!==m.props[v])break;m.props[v]=u[v]}if(s)for(var y=0,x=s.length;y<x;y++){var w=s[y].step(this,e,v,w);void 0!==w&&(e.props[v]=w)}}(o=this._injected)&&(this._injected=null,this._appendProps(o,e))},r.prototype._injectProps=function(t){var e=this._injected;this._injected||(e=this._injected={});for(var i in t)e[i]=t[i]},r.prototype._addStep=function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=new rt(this._stepTail,this.duration,t,e,i,r);return this.duration+=t,this._stepTail=this._stepTail.next=n},r.prototype._addAction=function(t,e,i){var r=new nt(this._actionTail,this.duration,t,e,i);return this._actionTail?this._actionTail.next=r:this._actionHead=r,this._actionTail=r,this},r.prototype._set=function(t){for(var e in t)this[e]=t[e]},r.prototype._cloneProps=function(t){var e={};for(var i in t)e[i]=t[i];return e},r}(J),it=et.prototype;it.w=it.wait,it.t=it.to,it.c=it.call,it.s=it.set,et.IGNORE={},et._tweens=[],et._plugins=null,et._tweenHead=null,et._tweenTail=null;var rt=function t(i,r,n,s,o,a){e(this,t),this.next=null,this.prev=i,this.t=r,this.d=n,this.props=s,this.ease=o,this.passive=a,this.index=i?i.index+1:0},nt=function t(i,r,n,s,o){e(this,t),this.next=null,this.d=0,this.prev=i,this.t=r,this.scope=n,this.funct=s,this.params=o},st=function(t){function i(r){e(this,i);var n=s(this,t.call(this,r));return n._tweens=[],r.tweens&&n.addTween.apply(n,tweens),n.labels=r.labels,n._init(r),n}return n(i,t),i.prototype.addTween=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.length;if(1===r){var n=e[0];this._tweens.push(n),n._parent=this,n.setPaused(!0);var s=n.duration;return n.loop>0&&(s*=n.loop+1),s>this.duration&&(this.duration=s),this.rawPosition>=0&&n.setPosition(this.rawPosition),n}if(r>1){for(var o=0;o<r;o++)this.addTween(e[o]);return e[r-1]}return null},i.prototype.removeTween=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.length;if(1===r){for(var n=this._tweens,s=n.length;s--;)if(n[s]===tween)return n.splice(s,1),tween._parent=null,tween.duration>=this.duration&&this.updateDuration(),!0;return!1}if(r>1){for(var o=!0,a=0;a<r;a++)o=o&&this.removeTween(e[a]);return o}return!0},i.prototype.updateDuration=function(){this.duration=0;for(var t=0,e=this._tweens.length;t<e;t++){var i=this._tweens[t],r=i.duration;i.loop>0&&(r*=i.loop+1),r>this.duration&&(this.duration=r)}},i.prototype.clone=function(){throw"Timeline can not be cloned."},i.prototype._updatePosition=function(t,e){for(var i=this.position,r=0,n=this._tweens.length;r<n;r++)this._tweens[r].setPosition(i,!0,t)},i.prototype._runActionsRange=function(t,e,i,r){for(var n=this.position,s=0,o=this._tweens.length;s<o;s++)if(this._tweens[s]._runActions(t,e,i,r),n!==this.position)return!0},i}(J),ot=function(t){function i(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.INDEPENDENT,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e(this,i);var h=s(this,t.call(this));return!i.inited&&i.init(),h.mode=r,h.startPosition=n,h.loop=o,h.currentFrame=0,h.timeline=new st(null,a,{paused:!0,position:n,useTicks:!0}),h.paused=!1,h.actionsEnabled=!0,h.autoReset=!0,h.frameBounds=h.frameBounds||null,h.framerate=null,h._synchOffset=0,h._prevPos=-1,h._prevPosition=0,h._t=0,h._managed={},h}return n(i,t),i.init=function(){i.inited||(at.install(),i.inited=!0)},i.prototype.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},i.prototype.draw=function(e,i){return!!this.cacheDraw(e,i)||(this._updateTimeline(),t.prototype.draw.call(this,e,i),!0)},i.prototype.play=function(){this.paused=!1},i.prototype.stop=function(){this.paused=!0},i.prototype.gotoAndPlay=function(t){this.paused=!1,this._goto(t)},i.prototype.gotoAndStop=function(t){this.paused=!0,this._goto(t)},i.prototype.advance=function(t){var e=i.INDEPENDENT;if(this.mode==e){for(var r=this,n=r.framerate;(r=r.parent)&&null==n;)r.mode==e&&(n=r._framerate);this._framerate=n;var s=null!=n&&n!=-1&&null!=t?t/(1e3/n)+this._t:1,o=0|s;for(this._t=s-o;!this.paused&&o--;)this._prevPosition=this._prevPos<0?0:this._prevPosition+1,this._updateTimeline()}},i.prototype.clone=function(){throw"MovieClip cannot be cloned."},i.prototype._tick=function(e){this.advance(e&&e.delta),t.prototype._tick.call(this,e)},i.prototype._goto=function(t){var e=this.timeline.resolve(t);null!=e&&(this._prevPos==-1&&(this._prevPos=NaN),this._prevPosition=e,this._t=0,this._updateTimeline())},i.prototype._reset=function(){this._prevPos=-1,this._t=this.currentFrame=0,this.paused=!1},i.prototype._updateTimeline=function(){var t=this.timeline,e=this.mode!=i.INDEPENDENT;t.loop=null==this.loop||this.loop;var r=e?this.startPosition+(this.mode==i.SINGLE_FRAME?0:this._synchOffset):this._prevPos<0?0:this._prevPosition,n=e||!this.actionsEnabled?et.NONE:null;if(this.currentFrame=t._calcPosition(r),t.setPosition(r,n),this._prevPosition=t._prevPosition,this._prevPos!=t._prevPos){this.currentFrame=this._prevPos=t._prevPos;for(var s in this._managed)this._managed[s]=1;for(var o=(t._tweens,t._tweens),a=Array.isArray(o),h=0,o=a?o:o[Symbol.iterator]();;){var u;if(a){if(h>=o.length)break;u=o[h++]}else{if(h=o.next(),h.done)break;u=h.value}var l=u,c=l._target;if(c!=this&&!l.passive){var p=l._stepPosition;c instanceof createjs.DisplayObject?this._addManagedChild(c,p):this._setState(c.state,p)}}for(var d=this.children,_=d.length-1;_>=0;_--){var f=d[_].id;1==this._managed[f]&&(this.removeChildAt(_),delete this._managed[f])}}},i.prototype._setState=function(t,e){if(t)for(var i=t.length-1;i>=0;i--){var r=t[i],n=r.t,s=r.p;for(var o in s)n[o]=s[o];this._addManagedChild(n,e)}},i.prototype._addManagedChild=function(t,e){t._off||(this.addChildAt(t,0),t instanceof i&&(t._synchOffset=e,t.mode==i.INDEPENDENT&&t.autoReset&&!this._managed[t.id]&&t._reset()),this._managed[t.id]=2)},i.prototype._getBounds=function(e,i){var r=this.getBounds();return r||(this._updateTimeline(),this.frameBounds&&(r=this._rectangle.copy(this.frameBounds[this.currentFrame]))),r?this._transformBounds(r,e,i):t.prototype._getBounds.call(this,e,i)},r(i,[{key:"labels",get:function(){return this.timeline.getLabels()}},{key:"currentLabel",get:function(){return this._updateTimeline(),this.timeline.getCurrentLabel()}},{key:"duration",get:function(){return this.timeline.duration}},{key:"totalFrames",get:function(){return this.duration}}]),i}(x);ot.INDEPENDENT="independent",ot.SINGLE_FRAME="single",ot.SYNCHED="synched",ot.inited=!1;var at=function(){function t(){throw e(this,t),"MovieClipPlugin cannot be instantiated."}return t.install=function(){et._installPlugin(t,["startPosition"])},t.init=function(t,e,i){return i},t.tween=function(t,e,i,r,n,s,o,a){return t.target instanceof ot?1==s?n[e]:r[e]:i},t}();at.priority=100;var ht=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"black",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e(this,t),this.color=i,this.offsetX=r,this.offsetY=n,this.blur=s}return t.prototype.toString=function(){return"["+this.constructor.name+"]"},t.prototype.clone=function(){return new t(this.color,this.offsetX,this.offsetY,this.blur)},t}();ht.identity=new ht("transparent");var ut=function(t){function i(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new I;e(this,i);var n=s(this,t.call(this));return n.graphics=r,n}return n(i,t),i.prototype.isVisible=function(){var t=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},i.prototype.draw=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!!t.prototype.draw.call(this,e,i)||(this.graphics.draw(e,this),!0)},i.prototype.clone=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=t&&this.graphics?this.graphics.clone():this.graphics;return this._cloneProps(new i(e))},i}(m),lt=function(t){function i(r){e(this,i);var n=s(this,t.call(this));return n.complete=!0,n.framerate=0,n._animations=null,n._frames=null,n._images=null,n._data=null,n._loadCount=0,n._frameHeight=0,n._frameWidth=0,n._numFrames=0,n._regX=0,n._regY=0,n._spacing=0,n._margin=0,n._parseData(r),n}return n(i,t),i.prototype.getNumFrames=function(t){if(null==t)return this._frames?this._frames.length:this._numFrames||0;var e=this._data[t];return null==e?0:e.frames.length},i.prototype.getAnimation=function(t){return this._data[t]},i.prototype.getFrame=function(t){var e=void 0;return this._frames&&(e=this._frames[t])?e:null},i.prototype.getFrameBounds=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new f,i=this.getFrame(t);return i?e.setValues(-i.regX,-i.regY,i.rect.width,i.rect.height):null},i.prototype.toString=function(){return"["+this.constructor.name+"]"},i.prototype.clone=function(){throw"SpriteSheet cannot be cloned."},i.prototype._parseData=function(t){var e=this;if(null!=t){if(this.framerate=t.framerate||0,t.images)for(var i=t.images,r=Array.isArray(i),n=0,i=r?i:i[Symbol.iterator]();;){var s;if(r){if(n>=i.length)break;s=i[n++]}else{if(n=i.next(),n.done)break;s=n.value}var o=s,a=this._images=[];if("string"==typeof o){var h=o;o=document.createElement("img"),o.src=h}a.push(o),o.getContext||o.naturalWidth||(this._loadCount++,this.complete=!1,o.onload=function(){return e._handleImadeLoad(src)},o.onerror=function(){return e._handleImageError(src)})}if(null!=t.frames)if(Array.isArray(t.frames)){this._frames=[];for(var u=t.frames,l=Array.isArray(u),c=0,u=l?u:u[Symbol.iterator]();;){var p;if(l){if(c>=u.length)break;p=u[c++]}else{if(c=u.next(),c.done)break;p=c.value}var d=p;this._frames.push({image:this._images[d[4]?d[4]:0],rect:new f(d[0],d[1],d[2],d[3]),regX:d[5]||0,regY:d[6]||0})}}else{var _=t.frames;this._frameWidth=_.width,this._frameHeight=_.height,this._regX=_.regX||0,this._regY=_.regY||0,this._spacing=_.spacing||0,this._margin=_.margin||0,this._numFrames=_.count,0==this._loadCount&&this._calculateFrames()}if(this._animations=[],null!=t.animations){this._data={};var v=t.animations;for(var g in v){var m={name:g},y=v[g],x=void 0;if("number"==typeof y)x=m.frames=[y];else if(Array.isArray(y))if(1==y.length)m.frames=[y[0]];else{m.speed=y[3],m.next=y[2],x=m.frames=[];for(var w=y[0];w<=y[1];w++)x.push(w)}else{m.speed=y.speed,m.next=y.next;var b=y.frames;x=m.frames="number"==typeof b?[b]:b.slice(0)}m.next!==!0&&void 0!==m.next||(m.next=g),(m.next===!1||x.length<2&&m.next==g)&&(m.next=null),m.speed||(m.speed=1),this._animations.push(g),this._data[g]=m}}}},i.prototype._handleImageLoad=function(t){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.dispatchEvent("complete"))},i.prototype._handleImageError=function(t){var e=new o("error");e.src=t,this.dispatchEvent(e),0==--this._loadCount&&this.dispatchEvent("complete")},i.prototype._calculateFrames=function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];var t=this._numFrames||1e5,e=0,i=this._frameWidth,r=this._frameHeight,n=this._spacing,s=this._margin;t:for(var o=0,a=this._images,h=a.length;o<h;o++)for(var u=a[o],l=u.width,c=u.height,p=s;p<=c-s-r;){for(var d=s;d<=l-s-i;){if(e>=t)break t;e++,this._frames.push({image:u,rect:new f(d,p,i,r),regX:this._regX,regY:this._regY}),d+=i+n}p+=r+n}this._numFrames=e}},r(i,[{key:"animations",get:function(){return this._animations.slice()}}]),i}(a),ct={start:0,left:0,center:-.5,end:-1,right:-1},pt={top:0,hanging:-.01,middle:-.4,alphabetic:-.8,ideographic:-.85,bottom:-1},dt=function(t){function i(r,n,o){e(this,i);var a=s(this,t.call(this));return a.text=r,a.font=n,a.color=o,a.textAlign="left",a.textBaseline="top",a.maxWidth=null,a.outline=0,a.lineHeight=0,a.lineWidth=null,a}return n(i,t),i.prototype.isVisible=function(){var t=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},i.prototype.draw=function(e,i){if(t.prototype.draw.call(this,e,i))return!0;var r=this.color||"#000";return this.outline?(e.strokeStyle=r,e.lineWidth=1*this.outline):e.fillStyle=r,this._drawText(this._prepContext(e)),!0},i.prototype.getMeasuredWidth=function(){return this._getMeasuredWidth(this.text)},i.prototype.getMeasuredLineHeight=function(){return 1.2*this._getMeasuredWidth("M")},i.prototype.getMeasuredHeight=function(){return this._drawText(null,{}).height},i.prototype.getBounds=function(){var e=t.prototype.getBounds.call(this);if(e)return e;if(null==this.text||""===this.text)return null;var r=this._drawText(null,{}),n=this.maxWidth&&this.maxWidth<r.width?this.maxWidth:r.width,s=n*i.H_OFFSETS[this.textAlign||"left"],o=this.lineHeight||this.getMeasuredLineHeight(),a=o*i.V_OFFSETS[this.textBaseline||"top"];return this._rectangle.setValues(s,a,n,r.height)},i.prototype.getMetrics=function(){var t={lines:[]};return t.lineHeight=this.lineHeight||this.getMeasuredLineHeight(),t.vOffset=t.lineHeight*i.V_OFFSETS[this.textBaseline||"top"],this._drawText(null,t,t.lines)},i.prototype.clone=function(){return this._cloneProps(new i(this.text,this.font,this.color))},i.prototype.toString=function(){return"["+this.constructor.name+" (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"},i.prototype._cloneProps=function(e){return t.prototype._cloneProps.call(this,e),e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.maxWidth=this.maxWidth,e.outline=this.outline,e.lineHeight=this.lineHeight,e.lineWidth=this.lineWidth,e},i.prototype._prepContext=function(t){return t.font=this.font||"10px sans-serif",t.textAlign=this.textAlign||"left",t.textBaseline=this.textBaseline||"top",t},i.prototype._drawText=function(t,e,r){var n=!!t;n||(t=i._workingContext,t.save(),this._prepContext(t));for(var s=this.lineHeight||this.getMeasuredLineHeight(),o=0,a=0,h=String(this.text).split(/(?:\r\n|\r|\n)/),u=h,l=Array.isArray(u),c=0,u=l?u:u[Symbol.iterator]();;){var p;if(l){if(c>=u.length)break;p=u[c++]}else{if(c=u.next(),c.done)break;p=c.value}var d=p,_=null;if(null!=this.lineWidth&&(_=t.measureText(d).width)>this.lineWidth){var f=d.split(/(\s)/);d=f[0],_=t.measureText(d).width;for(var v=f.length,g=1;g<v;g+=2){var m=t.measureText(f[g]+f[g+1]).width;_+m>this.lineWidth?(n&&this._drawTextLine(t,d,a*s),r&&r.push(d),_>o&&(o=_),d=f[g+1],_=t.measureText(d).width,a++):(d+=f[g]+f[g+1],_+=m)}}n&&this._drawTextLine(t,d,a*s),r&&r.push(d),e&&null==_&&(_=t.measureText(d).width),_>o&&(o=_),a++}return e&&(e.width=o,e.height=a*s),n||t.restore(),e},i.prototype._drawTextLine=function(t,e,i){this.outline?t.strokeText(e,0,i,this.maxWidth||65535):t.fillText(e,0,i,this.maxWidth||65535)},i.prototype._getMeasuredWidth=function(t){var e=i._workingContext;e.save();var r=this._prepContext(e).measureText(t).width;return e.restore(),r},r(i,null,[{key:"H_OFFSETS",get:function(){return ct}},{key:"V_OFFSETS",get:function(){return pt}}]),i}(m),_t=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");_t.getContext&&(dt._workingContext=_t.getContext("2d"),_t.width=_t.height=1);var ft=function(t){function i(r){e(this,i);var n=s(this,t.call(this));return n.alphaMap=r,n._alphaMap=null,n._mapData=null,n._mapTexture=null,n.FRAG_SHADER_BODY="\n\t\t\tuniform sampler2D uAlphaSampler;\n\n\t\t\tvoid main (void) {\n\t\t\t\tvec4 color = texture2D(uSampler, vRenderCoord);\n\t\t\t\tvec4 alphaMap = texture2D(uAlphaSampler, vTextureCoord);\n\n\t\t\t\t// some image formats can have transparent white rgba(1,1,1, 0) when put on the GPU, this means we need a slight tweak\n\t\t\t\t// using ceil ensure that the colour will be used so long as it exists but pure transparency will be treated black\n\t\t\t\tgl_FragColor = vec4(color.rgb, color.a * (alphaMap.r * ceil(alphaMap.a)));\n\t\t\t}\n\t\t",n}return n(i,t),i.prototype.shaderParamSetup=function(t,e,i){this._mapTexture||(this._mapTexture=t.createTexture()),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._mapTexture),e.setTextureParams(t),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.alphaMap),t.uniform1i(t.getUniformLocation(i,"uAlphaSampler"),1)},i.prototype.clone=function(){var t=new i(this.alphaMap);return t._alphaMap=this._alphaMap,t._mapData=this._mapData,t},i.prototype._applyFilter=function(t){if(!this.alphaMap)return!0;if(!this._prepAlphaMap())return!1;for(var e=t.data,i=this._mapData,r=e.length,n=0;n<r;n+=4)e[n+3]=i[n]||0;return!0},i.prototype._prepAlphaMap=function(){if(!this.alphaMap)return!1;if(this.alphaMap==this._alphaMap&&this._mapData)return!0;this._mapData=null;var t=this._alphaMap=this.alphaMap,e=t,i=void 0;t instanceof HTMLCanvasElement?i=e.getContext("2d"):(e=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),e.width=t.width,e.height=t.height,i=e.getContext("2d"),i.drawImage(t,0,0));try{return this._mapData=i.getImageData(0,0,t.width,t.height).data,
!0}catch(t){return!1}},i}(v),vt=function(t){function i(r){e(this,i);var n=s(this,t.call(this));return n.mask=r,n.FRAG_SHADER_BODY="\n\t\t\tuniform sampler2D uAlphaSampler;\n\n\t\t\tvoid main (void) {\n\t\t\t\tvec4 color = texture2D(uSampler, vRenderCoord);\n\t\t\t\tvec4 alphaMap = texture2D(uAlphaSampler, vTextureCoord);\n\n\t\t\t\tgl_FragColor = vec4(color.rgb, color.a * alphaMap.a);\n\t\t\t}\n\t\t",n}return n(i,t),i.prototype.applyFilter=function(t,e,i,r,n,s,o,a){return!this.mask||(s=s||t,null==o&&(o=e),null==a&&(a=i),s.save(),t==s&&(s.globalCompositeOperation="destination-in",s.drawImage(this.mask,o,a),s.restore(),!0))},i.prototype.clone=function(){return new i(this.mask)},i.prototype.shaderParamSetup=function(t,e,i){this._mapTexture||(this._mapTexture=t.createTexture()),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._mapTexture),e.setTextureParams(t),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.mask),t.uniform1i(t.getUniformLocation(i,"uAlphaSampler"),1)},i}(v),gt=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],mt=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9],yt=function(t){function i(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e(this,i);var a=s(this,t.call(this));return a._blurX=r,a._blurXTable=[],a._blurY=n,a._blurYTable=[],a._quality,a.FRAG_SHADER_TEMPLATE="\n\t\t\tuniform float xWeight[{{blurX}}];\n\t\t\tuniform float yWeight[{{blurY}}];\n\t\t\tuniform vec2 textureOffset;\n\t\t\tvoid main (void) {\n\t\t\t\tvec4 color = vec4(0.0);\n\n\t\t\t\tfloat xAdj = ({{blurX}}.0-1.0)/2.0;\n\t\t\t\tfloat yAdj = ({{blurY}}.0-1.0)/2.0;\n\t\t\t\tvec2 sampleOffset;\n\n\t\t\t\tfor(int i=0; i<{{blurX}}; i++) {\n\t\t\t\t\tfor(int j=0; j<{{blurY}}; j++) {\n\t\t\t\t\t\tsampleOffset = vRenderCoord + (textureOffset * vec2(float(i)-xAdj, float(j)-yAdj));\n\t\t\t\t\t\tcolor += texture2D(uSampler, sampleOffset) * (xWeight[i] * yWeight[j]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = color.rgba;\n\t\t\t}\n\t\t",a.quality=isNaN(o)||o<1?1:o,a}return n(i,t),i.prototype.updateShader=function(){var t=this.FRAG_SHADER_TEMPLATE;t=t.replace(/{{blurX}}/g,this._blurXTable.length.toFixed(0)),t=t.replace(/{{blurY}}/g,this._blurYTable.length.toFixed(0)),this.FRAG_SHADER_BODY=t},i.prototype.shaderParamSetup=function(t,e,i){t.uniform1fv(t.getUniformLocation(i,"xWeight"),this._blurXTable),t.uniform1fv(t.getUniformLocation(i,"yWeight"),this._blurYTable),t.uniform2f(t.getUniformLocation(i,"textureOffset"),2/(e._viewportWidth*this._quality),2/(e._viewportHeight*this._quality))},i.prototype.getBounds=function(t){var e=0|this.blurX,i=0|this.blurY;if(e<=0&&i<=0)return t;var r=Math.pow(this.quality,.2);return(t||new f).pad(e*r+1,i*r+1,e*r+1,i*r+1)},i.prototype.clone=function(){return new i(this.blurX,this.blurY,this.quality)},i.prototype._getTable=function(t){var e=4.2;if(t<=1)return[1];var i=[],r=Math.ceil(2*t);r+=r%2?0:1;for(var n=r/2|0,s=-n;s<=n;s++){var o=s/n*e;i.push(1/Math.sqrt(2*Math.PI)*Math.pow(Math.E,-(Math.pow(o,2)/4)))}var a=i.reduce(function(t,e){return t+e},0);return i.map(function(t){return t/a})},i.prototype._applyFilter=function(t){var e=this._blurX>>1;if(isNaN(e)||e<0)return!1;var r=this._blurY>>1;if(isNaN(r)||r<0)return!1;if(0==e&&0==r)return!1;var n=this.quality;(isNaN(n)||n<1)&&(n=1),n|=0,n>3&&(n=3),n<1&&(n=1);var s=t.data,o=0,a=0,h=0,u=0,l=0,c=0,p=0,d=0,_=0,f=0,v=0,g=0,m=0,y=0,x=0,w=e+e+1|0,b=r+r+1|0,T=0|t.width,E=0|t.height,R=T-1|0,A=E-1|0,C=e+1|0,D=r+1|0,S={r:0,b:0,g:0,a:0},I=S;for(h=1;h<w;h++)I=I.n={r:0,b:0,g:0,a:0};I.n=S;var P={r:0,b:0,g:0,a:0},M=P;for(h=1;h<b;h++)M=M.n={r:0,b:0,g:0,a:0};M.n=P;for(var L=null,k=0|i.MUL_TABLE[e],F=0|i.SHG_TABLE[e],O=0|i.MUL_TABLE[r],B=0|i.SHG_TABLE[r];n-- >0;){p=c=0;var G=k,U=F;for(a=E;--a>-1;){for(d=C*(g=s[0|c]),_=C*(m=s[c+1|0]),f=C*(y=s[c+2|0]),v=C*(x=s[c+3|0]),I=S,h=C;--h>-1;)I.r=g,I.g=m,I.b=y,I.a=x,I=I.n;for(h=1;h<C;h++)u=c+((R<h?R:h)<<2)|0,d+=I.r=s[u],_+=I.g=s[u+1],f+=I.b=s[u+2],v+=I.a=s[u+3],I=I.n;for(L=S,o=0;o<T;o++)s[c++]=d*G>>>U,s[c++]=_*G>>>U,s[c++]=f*G>>>U,s[c++]=v*G>>>U,u=p+((u=o+e+1)<R?u:R)<<2,d-=L.r-(L.r=s[u]),_-=L.g-(L.g=s[u+1]),f-=L.b-(L.b=s[u+2]),v-=L.a-(L.a=s[u+3]),L=L.n;p+=T}for(G=O,U=B,o=0;o<T;o++){for(c=o<<2|0,d=D*(g=s[c])|0,_=D*(m=s[c+1|0])|0,f=D*(y=s[c+2|0])|0,v=D*(x=s[c+3|0])|0,M=P,h=0;h<D;h++)M.r=g,M.g=m,M.b=y,M.a=x,M=M.n;for(l=T,h=1;h<=r;h++)c=l+o<<2,d+=M.r=s[c],_+=M.g=s[c+1],f+=M.b=s[c+2],v+=M.a=s[c+3],M=M.n,h<A&&(l+=T);if(c=o,L=P,n>0)for(a=0;a<E;a++)u=c<<2,s[u+3]=x=v*G>>>U,x>0?(s[u]=d*G>>>U,s[u+1]=_*G>>>U,s[u+2]=f*G>>>U):s[u]=s[u+1]=s[u+2]=0,u=o+((u=a+D)<A?u:A)*T<<2,d-=L.r-(L.r=s[u]),_-=L.g-(L.g=s[u+1]),f-=L.b-(L.b=s[u+2]),v-=L.a-(L.a=s[u+3]),L=L.n,c+=T;else for(a=0;a<E;a++)u=c<<2,s[u+3]=x=v*G>>>U,x>0?(x=255/x,s[u]=(d*G>>>U)*x,s[u+1]=(_*G>>>U)*x,s[u+2]=(f*G>>>U)*x):s[u]=s[u+1]=s[u+2]=0,u=o+((u=a+D)<A?u:A)*T<<2,d-=L.r-(L.r=s[u]),_-=L.g-(L.g=s[u+1]),f-=L.b-(L.b=s[u+2]),v-=L.a-(L.a=s[u+3]),L=L.n,c+=T}}return!0},r(i,[{key:"blurX",get:function(){return this._blurX},set:function(t){(isNaN(t)||t<0)&&(t=0),this._blurX=t,this._blurXTable=this._getTable(t*this._quality),this.updateShader()}},{key:"blurY",get:function(){return this._blurY},set:function(t){(isNaN(t)||t<0)&&(t=0),this._blurY=t,this._blurYTable=this._getTable(t*this._quality),this.updateShader()}},{key:"quality",get:function(){return this._quality},set:function(t){this._quality=t,this._blurXTable=this._getTable(this._blurX*this._quality),this._blurYTable=this._getTable(this._blurY*this._quality),this.updateShader()}}],[{key:"MUL_TABLE",get:function(){return gt}},{key:"SHG_TABLE",get:function(){return mt}}]),i}(v),xt=function(t){function i(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;e(this,i);var p=s(this,t.call(this));return p.redMultiplier=r,p.greenMultiplier=n,p.blueMultiplier=o,p.alphaMultiplier=a,p.redOffset=h,p.greenOffset=u,p.blueOffset=l,p.alphaOffset=c,p.FRAG_SHADER_BODY="\n\t\t\tuniform vec4 uColorMultiplier;\n\t\t\tuniform vec4 uColorOffset;\n\n\t\t\tvoid main (void) {\n\t\t\t\tvec4 color = texture2D(uSampler, vRenderCoord);\n\n\t\t\t\tgl_FragColor = (color * uColorMultiplier) + uColorOffset;\n\t\t\t}\n\t\t",p}return n(i,t),i.prototype.shaderParamSetup=function(t,e,i){t.uniform4f(t.getUniformLocation(i,"uColorMultiplier"),this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier),t.uniform4f(t.getUniformLocation(i,"uColorOffset"),this.redOffset/255,this.greenOffset/255,this.blueOffset/255,this.alphaOffset/255)},i.prototype.clone=function(){return new i(this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)},i.prototype._applyFilter=function(t){for(var e=t.data,i=e.length,r=0;r<i;r+=4)e[r]=e[r]*this.redMultiplier+this.redOffset,e[r+1]=e[r+1]*this.greenMultiplier+this.greenOffset,e[r+2]=e[r+2]*this.blueMultiplier+this.blueOffset,e[r+3]=e[r+3]*this.alphaMultiplier+this.alphaOffset;return!0},i}(v),wt=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],bt=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],Tt=25,Et=function(){function t(i,r,n,s){e(this,t),this.setColor(i,r,n,s)}return t.prototype.setColor=function(t,e,i,r){return this.reset().adjustColor(t,e,i,r)},t.prototype.reset=function(){return this.copy(t.IDENTITY_MATRIX)},t.prototype.adjustColor=function(t,e,i,r){return this.adjustHue(r),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i)},t.prototype.adjustBrightness=function(t){return 0==t||isNaN(t)?this:(t=this._cleanValue(t,255),this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1]),this)},t.prototype.adjustContrast=function(e){if(0==e||isNaN(e))return this;e=this._cleanValue(e,100);var i=void 0;return e<0?i=127+e/100*127:(i=e%1,i=0==i?t.DELTA_INDEX[e]:t.DELTA_INDEX[e<<0]*(1-i)+t.DELTA_INDEX[(e<<0)+1]*i,i=127*i+127),this._multiplyMatrix([i/127,0,0,0,.5*(127-i),0,i/127,0,0,.5*(127-i),0,0,i/127,0,.5*(127-i),0,0,0,1,0,0,0,0,0,1]),this},t.prototype.adjustSaturation=function(t){if(0==t||isNaN(t))return this;t=this._cleanValue(t,100);var e=1+(t>0?3*t/100:t/100),i=.3086,r=.6094,n=.082;return this._multiplyMatrix([i*(1-e)+e,r*(1-e),n*(1-e),0,0,i*(1-e),r*(1-e)+e,n*(1-e),0,0,i*(1-e),r*(1-e),n*(1-e)+e,0,0,0,0,0,1,0,0,0,0,0,1]),this},t.prototype.adjustHue=function(t){if(0==t||isNaN(t))return this;t=this._cleanValue(t,180)/180*Math.PI;var e=Math.cos(t),i=Math.sin(t),r=.213,n=.715,s=.072;return this._multiplyMatrix([r+e*(1-r)+i*-r,n+e*-n+i*-n,s+e*-s+i*(1-s),0,0,r+e*-r+.143*i,n+e*(1-n)+.14*i,s+e*-s+i*-.283,0,0,r+e*-r+i*-(1-r),n+e*-n+i*n,s+e*(1-s)+i*s,0,0,0,0,0,1,0,0,0,0,0,1]),this},t.prototype.concat=function(e){return e=this._fixMatrix(e),e.length!=t.LENGTH?this:(this._multiplyMatrix(e),this)},t.prototype.clone=function(){return(new t).copy(this)},t.prototype.toArray=function(){for(var e=[],i=t.LENGTH,r=0;r<i;r++)e[r]=this[r];return e},t.prototype.copy=function(e){for(var i=t.LENGTH,r=0;r<i;r++)this[r]=e[r];return this},t.prototype.toString=function(){return"["+this.constructor.name+"]"},t.prototype._multiplyMatrix=function(t){for(var e=[],i=0;i<5;i++){for(var r=0;r<5;r++)e[r]=this[r+5*i];for(var n=0;n<5;n++){for(var s=0,o=0;o<5;o++)s+=t[n+5*o]*e[o];this[n+5*i]=s}}},t.prototype._cleanValue=function(t,e){return Math.min(e,Math.max(-e,t))},t.prototype._fixMatrix=function(e){return e instanceof t&&(e=e.toArray()),e.length<t.LENGTH?e=e.slice(0,e.length).concat(t.IDENTITY_MATRIX.slice(e.length,t.LENGTH)):e.length>t.LENGTH&&(e=e.slice(0,t.LENGTH)),e},r(t,null,[{key:"DELTA_INDEX",get:function(){return wt}},{key:"IDENTITY_MATRIX",get:function(){return bt}},{key:"LENGTH",get:function(){return Tt}}]),t}(),Rt=function(t){function i(r){e(this,i);var n=s(this,t.call(this));return n.matrix=r,n.FRAG_SHADER_BODY="\n\t\t\tuniform mat4 uColorMatrix;\n\t\t\tuniform vec4 uColorMatrixOffset;\n\n\t\t\tvoid main (void) {\n\t\t\t\tvec4 color = texture2D(uSampler, vRenderCoord);\n\n\t\t\t\tmat4 m = uColorMatrix;\n\t\t\t\tvec4 newColor = vec4(0,0,0,0);\n\t\t\t\tnewColor.r = color.r*m[0][0] + color.g*m[0][1] + color.b*m[0][2] + color.a*m[0][3];\n\t\t\t\tnewColor.g = color.r*m[1][0] + color.g*m[1][1] + color.b*m[1][2] + color.a*m[1][3];\n\t\t\t\tnewColor.b = color.r*m[2][0] + color.g*m[2][1] + color.b*m[2][2] + color.a*m[2][3];\n\t\t\t\tnewColor.a = color.r*m[3][0] + color.g*m[3][1] + color.b*m[3][2] + color.a*m[3][3];\n\n\t\t\t\tgl_FragColor = newColor + uColorMatrixOffset;\n\t\t\t}\n\t\t",n}return n(i,t),i.prototype.shaderParamSetup=function(t,e,i){var r=this.matrix,n=new Float32Array([r[0],r[1],r[2],r[3],r[5],r[6],r[7],r[8],r[10],r[11],r[12],r[13],r[15],r[16],r[17],r[18]]);t.uniformMatrix4fv(t.getUniformLocation(i,"uColorMatrix"),!1,n),t.uniform4f(t.getUniformLocation(i,"uColorMatrixOffset"),r[4]/255,r[9]/255,r[14]/255,r[19]/255)},i.prototype.clone=function(){return new i(this.matrix)},i.prototype._applyFilter=function(t){for(var e=t.data,i=e.length,r=void 0,n=void 0,s=void 0,o=void 0,a=this.matrix,h=a[0],u=a[1],l=a[2],c=a[3],p=a[4],d=a[5],_=a[6],f=a[7],v=a[8],g=a[9],m=a[10],y=a[11],x=a[12],w=a[13],b=a[14],T=a[15],E=a[16],R=a[17],A=a[18],C=a[19],D=0;D<i;D+=4)r=e[D],n=e[D+1],s=e[D+2],o=e[D+3],e[D]=r*h+n*u+s*l+o*c+p,e[D+1]=r*d+n*_+s*f+o*v+g,e[D+2]=r*m+n*y+s*x+o*w+b,e[D+3]=r*T+n*E+s*R+o*A+C;return!0},i}(v),At=function(){function t(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"out",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"over",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"down",o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments[5],h=arguments[6];e(this,t),i.addEventListener&&(this.target=i,this.overLabel=n,this.outLabel=r,this.downLabel=null==s,this.play=o,this._isPressed=!1,this._isOver=!1,this._enabled=!1,i.mouseChildren=!1,this.enabled=!0,this.handleEvent({}),a&&(h&&(a.actionsEnabled=!1,a.gotoAndStop&&a.gotoAndStop(h)),i.hitArea=a))}return t.prototype.toString=function(){return"["+this.constructor.name+"]"},t.prototype.handleEvent=function(t){var e=void 0,i=this.target,r=t.type;"mousedown"==r?(this._isPressed=!0,e=this.downLabel):"pressup"==r?(this._isPressed=!1,e=this._isOver?this.overLabel:this.outLabel):"rollover"==r?(this._isOver=!0,e=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,e=this._isPressed?this.overLabel:this.outLabel),this.play?i.gotoAndPlay&&i.gotoAndPlay(e):i.gotoAndStop&&i.gotoAndStop(e)},t.prototype._reset=function(){var t=this.paused;this.__reset(),this.paused=t},r(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){if(t!=this._enabled){var e=this.target;this._enabled=t,t?(e.cursor="pointer",e.addEventListener("rollover",this),e.addEventListener("rollout",this),e.addEventListener("mousedown",this),e.addEventListener("pressup",this),e._reset&&(e.__reset=e._reset,e._reset=this._reset)):(e.cursor=null,e.removeEventListener("rollover",this),e.removeEventListener("rollout",this),e.removeEventListener("mousedown",this),e.removeEventListener("pressup",this),e.__reset&&(e._reset=e.__reset,delete e.__reset))}}}]),t}(),Ct=function(){function t(){throw e(this,t),"Touch cannot be instantiated"}return t.isSupported=function(){return!!("ontouchstart"in window||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0)},t.enable=function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!!(e&&e.canvas&&t.isSupported())&&(!!e.__touch||(e.__touch={pointers:{},multitouch:!i,preventDefault:!r,count:0},"ontouchstart"in window?t._IOS_enable(e):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&t._IE_enable(e),!0))},t.disable=function(e){e&&("ontouchstart"in window?t._IOS_disable(e):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&t._IE_disable(e),delete e.__touch)},t._IOS_enable=function(e){var i=e.canvas,r=e.__touch.f=function(i){return t._IOS_handleEvent(e,i)};i.addEventListener("touchstart",r,!1),i.addEventListener("touchmove",r,!1),i.addEventListener("touchend",r,!1),i.addEventListener("touchcancel",r,!1)},t._IOS_disable=function(t){var e=t.canvas;if(e){var i=t.__touch.f;e.removeEventListener("touchstart",i,!1),e.removeEventListener("touchmove",i,!1),e.removeEventListener("touchend",i,!1),e.removeEventListener("touchcancel",i,!1)}},t._IOS_handleEvent=function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();for(var i=e.changedTouches,r=e.type,n=(i.length,i),s=Array.isArray(n),o=0,n=s?n:n[Symbol.iterator]();;){var a;if(s){if(o>=n.length)break;a=n[o++]}else{if(o=n.next(),o.done)break;a=o.value}var h=a,u=h.identifier;h.target==t.canvas&&("touchstart"==r?this._handleStart(t,u,e,h.pageX,h.pageY):"touchmove"==r?this._handleMove(t,u,e,h.pageX,h.pageY):"touchend"!=r&&"touchcancel"!=r||this._handleEnd(t,u,e))}}},t._IE_enable=function(e){var i=e.canvas,r=e.__touch.f=function(i){return t._IE_handleEvent(e,i)};void 0===window.navigator.pointerEnabled?(i.addEventListener("MSPointerDown",r,!1),window.addEventListener("MSPointerMove",r,!1),window.addEventListener("MSPointerUp",r,!1),window.addEventListener("MSPointerCancel",r,!1),e.__touch.preventDefault&&(i.style.msTouchAction="none")):(i.addEventListener("pointerdown",r,!1),window.addEventListener("pointermove",r,!1),window.addEventListener("pointerup",r,!1),window.addEventListener("pointercancel",r,!1),e.__touch.preventDefault&&(i.style.touchAction="none")),e.__touch.activeIDs={}},t._IE_disable=function(t){var e=t.__touch.f;void 0===window.navigator.pointerEnabled?(window.removeEventListener("MSPointerMove",e,!1),window.removeEventListener("MSPointerUp",e,!1),window.removeEventListener("MSPointerCancel",e,!1),t.canvas&&t.canvas.removeEventListener("MSPointerDown",e,!1)):(window.removeEventListener("pointermove",e,!1),window.removeEventListener("pointerup",e,!1),window.removeEventListener("pointercancel",e,!1),t.canvas&&t.canvas.removeEventListener("pointerdown",e,!1))},t._IE_handleEvent=function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();var i=e.type,r=e.pointerId,n=t.__touch.activeIDs;if("MSPointerDown"==i||"pointerdown"==i){if(e.srcElement!=t.canvas)return;n[r]=!0,this._handleStart(t,r,e,e.pageX,e.pageY)}else n[r]&&("MSPointerMove"==i||"pointermove"==i?this._handleMove(t,r,e,e.pageX,e.pageY):"MSPointerUp"!=i&&"MSPointerCancel"!=i&&"pointerup"!=i&&"pointercancel"!=i||(delete n[r],this._handleEnd(t,r,e)))}},t._handleStart=function(t,e,i,r,n){var s=t.__touch;if(s.multitouch||!s.count){var o=s.pointers;o[e]||(o[e]=!0,s.count++,t._handlePointerDown(e,i,r,n))}},t._handleMove=function(t,e,i,r,n){t.__touch.pointers[e]&&t._handlePointerMove(e,i,r,n)},t._handleEnd=function(t,e,i){var r=t.__touch,n=r.pointers;n[e]&&(r.count--,t._handlePointerUp(e,i,!0),delete n[e])},t}(),Dt="frame dimensions exceed max spritesheet dimensions",St="a build is already running",It=function(t){function i(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e(this,i);var n=s(this,t.call(this));return n.maxWidth=2048,n.maxHeight=2048,n.spriteSheet=null,n.scale=1,n.padding=1,n.timeSlice=.3,n.progress=-1,n.framerate=r,n._frames=[],n._animations={},n._data=null,n._nextFrameIndex=0,n._index=0,n._timerID=null,n._scale=1,n}return n(i,t),i.prototype.addFrame=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments[3],s=arguments[4];if(this._data)throw i.ERR_RUNNING;var o=e||t.bounds||t.nominalBounds||t.getBounds&&t.getBounds();return o?this._frames.push({source:t,sourceRect:o,scale:r,funct:n,data:s,index:this._frames.length,height:o.height*r})-1:null},i.prototype.addAnimation=function(t,e,r,n){if(this._data)throw i.ERR_RUNNING;this._animations[t]={frames:e,next:r,speed:n}},i.prototype.addMovieClip=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments[3],s=arguments[4],o=arguments[5];if(this._data)throw i.ERR_RUNNING;var a=t.frameBounds,h=e||t.bounds||t.nominalBounds||t.getBounds&&t.getBounds();if(h||a){for(var u=this._frames.length,l=t.timeline.duration,c=0;c<l;c++){var p=a&&a[c]?a[c]:h;this.addFrame(t,p,r,this._setupMovieClipFrame,{i:c,f:n,d:s})}var d=t.timeline._labels,_=[];for(var f in d)_.push({index:d[f],label:f});if(_.length){_.sort(function(t,e){return t.index-e.index});for(var v=0,g=_.length;v<g;v++){for(var m=_[v].label,y=u+_[v].index,x=u+(v==g-1?l:_[v+1].index),w=[],b=y;b<x;b++)w.push(b);o&&!(m=o(m,t,y,x))||this.addAnimation(m,w,!0)}}}},i.prototype.build=function(){if(this._data)throw i.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet},i.prototype.buildAsync=function(t){var e=this;if(this._data)throw i.ERR_RUNNING;this.timeSlice=t,this._startBuild(),this._timerID=setTimeout(function(){return e._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))},i.prototype.stopAsync=function(){clearTimeout(this._timerID),this._data=null},i.prototype.clone=function(){throw"SpriteSheetBuilder cannot be cloned."},i.prototype.toString=function(){return"["+this.constructor.name+"]"},i.prototype._startBuild=function(){var t=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var e=[];this._data={images:[],frames:e,framerate:this.framerate,animations:this._animations};var r=this._frames.slice();if(r.sort(function(t,e){return t.height<=e.height?-1:1}),r[r.length-1].height+2*t>this.maxHeight)throw i.ERR_DIMENSIONS;for(var n=0,s=0,o=0;r.length;){var a=this._fillRow(r,n,o,e,t);if(a.w>s&&(s=a.w),n+=a.h,!a.h||!r.length){var h=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");h.width=this._getSize(s,this.maxWidth),h.height=this._getSize(n,this.maxHeight),this._data.images[o]=h,a.h||(s=n=0,o++)}}},i.prototype._setupMovieClipFrame=function(t,e){var i=t.actionsEnabled;t.actionsEnabled=!1,t.gotoAndStop(e.i),t.actionsEnabled=i,e.f&&e.f(t,e.d,e.i)},i.prototype._getSize=function(t,e){for(var i=4;Math.pow(2,++i)<t;);return Math.min(e,Math.pow(2,i))},i.prototype._fillRow=function(t,e,r,n,s){var o=this.maxWidth,a=this.maxHeight;e+=s;for(var h=a-e,u=s,l=0,c=t.length-1;c>=0;c--){var p=t[c],d=this._scale*p.scale,_=p.sourceRect,v=p.source,g=Math.floor(d*_.x-s),m=Math.floor(d*_.y-s),y=Math.ceil(d*_.height+2*s),x=Math.ceil(d*_.width+2*s);if(x>o)throw i.ERR_DIMENSIONS;y>h||u+x>o||(p.img=r,p.rect=new f(u,e,x,y),l=l||y,t.splice(c,1),n[p.index]=[u,e,x,y,r,Math.round(-g+d*v.regX-s),Math.round(-m+d*v.regY-s)],u+=x)}return{w:u,h:l}},i.prototype._endBuild=function(){this.spriteSheet=new lt(this._data),this._data=null,this.progress=1,this.dispatchEvent("complete")},i.prototype._run=function(){for(var t=this,e=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),i=(new Date).getTime()+e,r=!1;i>(new Date).getTime();)if(!this._drawNext()){r=!0;break}r?this._endBuild():this._timerID=setTimeout(function(){return t._run()},50-e);var n=this.progress=this._index/this._frames.length;if(this.hasEventListener("progress")){var s=new o("progress");s.progress=n,this.dispatchEvent(s)}},i.prototype._drawNext=function(){var t=this._frames[this._index],e=t.scale*this._scale,i=t.rect,r=t.sourceRect,n=this._data.images[t.img],s=n.getContext("2d");return t.funct&&t.funct(t.source,t.data),s.save(),s.beginPath(),s.rect(i.x,i.y,i.width,i.height),s.clip(),s.translate(Math.ceil(i.x-r.x*e),Math.ceil(i.y-r.y*e)),s.scale(e,e),t.source.draw(s),s.restore(),++this._index<this._frames.length},r(i,null,[{key:"ERR_DIMENSIONS",get:function(){return Dt}},{key:"ERR_RUNNING",get:function(){return St}}]),i}(a),Pt=function(){function t(){throw e(this,t),"SpriteSheetUtils cannot be instantiated"}return t.extractFrame=function(e,i){isNaN(i)&&(i=e.getAnimation(i).frames[0]);var r=e.getFrame(i);if(!r)return null;var n=r.rect,s=t._workingCanvas;s.width=n.width,s.height=n.height,t._workingContext.drawImage(r.image,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var o=document.createElement("img");return o.src=s.toDataURL("image/png"),o},t.mergeAlpha=function(t,e,i){i||(i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),i.width=Math.max(e.width,t.width),i.height=Math.max(e.height,t.height);var r=i.getContext("2d");return r.save(),r.drawImage(t,0,0),r.globalCompositeOperation="destination-in",r.drawImage(e,0,0),r.restore(),i},t._flip=function(e,i,r,n){for(var s=e._images,o=t._workingCanvas,a=t._workingContext,h=s.length/i,u=0;u<h;u++){var l=s[u];l.__tmp=u,a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,o.width+1,o.height+1),o.width=l.width,o.height=l.height,a.setTransform(r?-1:1,0,0,n?-1:1,r?l.width:0,n?l.height:0),a.drawImage(l,0,0);var c=document.createElement("img");c.src=o.toDataURL("image/png"),c.width=l.width,c.height=l.height,s.push(c)}for(var p=e._frames,d=p.length/i,_=0;_<d;_++){var f=p[_],v=f.rect.clone(),g=s[f.image.__tmp+h*i],m={image:g,rect:v,regX:f.regX,regY:f.regY};r&&(v.x=g.width-v.x-v.width,m.regX=v.width-f.regX),n&&(v.y=g.height-v.y-v.height,m.regY=v.height-f.regY),p.push(m)}for(var y="_"+(r?"h":"")+(n?"v":""),x=e._animations,w=e._data,b=x.length/i,T=0;T<b;T++){var E=x[T],R=w[E],A={name:E+y,speed:R.speed,next:R.next,frames:[]};R.next&&(A.next+=y);for(var C=R.frames,D=0,S=C.length;D<S;D++)A.frames.push(C[D]+d*i);w[A.name]=A,x.push(A.name)}},t}(),Mt=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");Mt.getContext&&(Pt._workingCanvas=Mt,Pt._workingContext=Mt.getContext("2d"),Mt.width=Mt.height=1);var Lt=null,kt=function(t){function i(r){e(this,i);var n=s(this,t.call(this));return n._stage=r,n}return n(i,t),i.dispProps=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r="\tP: "+t.x.toFixed(2)+"x"+t.y.toFixed(2)+"\t",n="\tR: "+t.regX.toFixed(2)+"x"+t.regY.toFixed(2)+"\t";i._log(e,t.toString()+"\t",r,n)},i._log=function(){if(i.alternateOutput){var t;(t=i.alternateOutput).log.apply(t,arguments)}else{var e;(e=console).log.apply(e,arguments)}},i.prototype.log=function(t){t||(t=this._stage),i._log("Batches Per Draw: "+(t._batchID/t._drawID).toFixed(4)),this.logContextInfo(t._webGLContext),this.logDepth(t.children,""),this.logTextureFill(t)},i.prototype.toggleGPUDraw=function(t,e){t||(t=this._stage),void 0===e&&(e=!!t._drawBuffers_),e&&t._drawBuffers_?(t._drawBuffers=t._drawBuffers_,t._drawBuffers_=void 0):(t._drawBuffers_=t._drawBuffers,t._drawBuffers=function(t){this.vocalDebug&&i._log("BlankDraw["+this._drawID+":"+this._batchID+"] : "+this.batchReason)})},i.prototype.logDepth=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i._log;t||(t=this._stage.children);for(var n=t.length,s=0;s<n;s++){var o=t[s];r(e+"-",o),o.children&&o.children.length&&this.logDepth(o.children,"|"+e,r)}},i.prototype.logContextInfo=function(t){t||(t=this._stage._webGLContext);var e="\n\t\t\t== LOG:\n\n\t\t\tMax textures per draw: "+t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)+"\n\n\t\t\tMax textures active: "+t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS)+"\n\n\t\t\t\n\n\t\t\tMax texture size: "+t.getParameter(t.MAX_TEXTURE_SIZE)/2+"\n\n\t\t\tMax cache size: "+t.getParameter(t.MAX_RENDERBUFFER_SIZE)/2+"\n\n\t\t\t\n\n\t\t\tMax attributes per vertex: "+t.getParameter(t.MAX_VERTEX_ATTRIBS)+"\n\n\t\t\tWebGL Version string: "+t.getParameter(t.VERSION)+"\n\n\t\t\t======\n\t\t";i._log(e)},i.prototype.logTextureFill=function(t){t||(t=this._stage);var e=t._textureDictionary,r=t._batchTextureCount;i._log(textureMax+": "+r);var n=[];for(var s in e){var o=(s.replace(window.location.origin,""),e[s]),a=!!o._lastActiveIndex&&o._lastActiveIndex==o._activeIndex;n.push({src:src,element:o,shifted:a}),o._lastActiveIndex=o._activeIndex}n.sort(function(e,i){return e.element._drawID==t._drawID?1:e.element._drawID<i.element._drawID?-1:0});for(var h=n.length,u=0;u<h;u++){var l=n[u],c=l.element._drawID==t._drawID;i._log("["+l.src+"] "+(c?"ACTIVE":"stale")+" "+(l.shifted?"steady":"DRIFT"),l.element)}},r(i,null,[{key:"alternateOutput",get:function(){return Lt},set:function(t){Lt=t}}]),i}(a),Ft="1.0.0";t.version=Ft,t.EventDispatcher=a,t.Event=o,t.Ticker=u,t.StageGL=T,t.Stage=b,t.Container=x,t.DisplayObject=m,t.Bitmap=E,t.BitmapText=D,t.DOMElement=S,t.Graphics=I,t.Arc=k,t.ArcTo=L,t.BeginPath=U,t.BezierCurveTo=O,t.Circle=W,t.ClosePath=G,t.Ellipse=j,t.Fill=N,t.LineTo=P,t.MoveTo=M,t.PolyStar=z,t.QuadraticCurveTo=F,t.Rect=B,t.RoundRect=V,t.Stroke=X,t.StrokeDash=H,t.StrokeStyle=Y,t.MovieClip=ot,t.Shadow=ht,t.Shape=ut,t.Sprite=R,t.SpriteSheet=lt,t.Text=dt,t.MouseEvent=w,t.AlphaMapFilter=ft,t.AlphaMaskFilter=vt,t.BitmapCache=g,t.BlurFilter=yt,t.ColorFilter=xt,t.ColorMatrix=Et,t.ColorMatrixFilter=Rt,t.Filter=v,t.DisplayProps=_,t.Matrix2D=d,t.Point=p,t.Rectangle=f,t.ButtonHelper=At,t.Touch=Ct,t.SpriteSheetBuilder=It,t.SpriteSheetUtils=Pt,t.UID=c,t.WebGLInspector=kt}(this.createjs=this.createjs||{});